<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.1 JavaScript基础 | Electrolux博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/front-base-know-blog/assets/css/0.styles.1c0757d4.css" as="style"><link rel="preload" href="/front-base-know-blog/assets/js/app.02046710.js" as="script"><link rel="preload" href="/front-base-know-blog/assets/js/3.a15d85cc.js" as="script"><link rel="preload" href="/front-base-know-blog/assets/js/1.704023bf.js" as="script"><link rel="preload" href="/front-base-know-blog/assets/js/17.a24d0ce5.js" as="script"><link rel="prefetch" href="/front-base-know-blog/assets/js/10.4e1c0929.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/11.3f1775f7.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/12.ab575625.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/13.f613d5a1.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/14.c19bf21c.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/15.9580c3d6.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/16.e1171fb0.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/18.72179347.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/19.740282d2.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/20.101e2711.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/21.da2c5a6f.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/22.f708860b.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/23.4b402e2e.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/24.df4bfa75.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/25.d68a182a.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/26.acdc34a9.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/27.3d3381ed.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/28.214a9297.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/29.5000b97e.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/30.cb2c9843.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/31.c4d9b3a1.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/4.11c729f5.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/5.41f9e3e8.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/6.de585bd1.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/7.234840ab.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/8.f66853e2.js"><link rel="prefetch" href="/front-base-know-blog/assets/js/9.a973a9a9.js">
    <link rel="stylesheet" href="/front-base-know-blog/assets/css/0.styles.1c0757d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Electrolux博客</h3> <p class="description" data-v-59e6cb88></p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-base-know-blog/" class="home-link router-link-active"><!----> <span class="site-name">Electrolux博客</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-base-know-blog/know/1.html.html" class="nav-link"><i class="undefined"></i>
  html
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/2.javascript基础.html" class="nav-link"><i class="undefined"></i>
  js基础
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/5.css.html" class="nav-link"><i class="undefined"></i>
  css
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/八股/1.计算机网络.html" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      常用
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-base-know-blog/know/7.算法.html" class="nav-link"><i class="undefined"></i>
  设计模式 | 算法
</a></li><li class="dropdown-item"><!----> <a href="/front-base-know-blog/know/10.性能优化.html" class="nav-link"><i class="undefined"></i>
  性能优化
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>21</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/front-base-know-blog/know/1.html.html" class="nav-link"><i class="undefined"></i>
  html
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/2.javascript基础.html" class="nav-link"><i class="undefined"></i>
  js基础
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/5.css.html" class="nav-link"><i class="undefined"></i>
  css
</a></div><div class="nav-item"><a href="/front-base-know-blog/know/八股/1.计算机网络.html" class="nav-link"><i class="undefined"></i>
  计算机网络
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      常用
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-base-know-blog/know/7.算法.html" class="nav-link"><i class="undefined"></i>
  设计模式 | 算法
</a></li><li class="dropdown-item"><!----> <a href="/front-base-know-blog/know/10.性能优化.html" class="nav-link"><i class="undefined"></i>
  性能优化
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-base-know-blog/know/1.html.html" class="sidebar-link">1.HTML（浏览器机制）</a></li><li><a href="/front-base-know-blog/know/2.0javascript基础.html" class="sidebar-link">2.JavaScript基础</a></li><li><a href="/front-base-know-blog/know/2.1.javascript基础.html" class="active sidebar-link">2.1 JavaScript基础</a></li><li><a href="/front-base-know-blog/know/2.2.ts.html" class="sidebar-link">2.2. ts</a></li><li><a href="/front-base-know-blog/know/2.9.javascript代码输出题.html" class="sidebar-link">2.9 JavaScript代码输出题</a></li><li><a href="/front-base-know-blog/know/3.javascript-es6.html" class="sidebar-link">3.JavaScript-es6</a></li><li><a href="/front-base-know-blog/know/4.javascript-手写题.html" class="sidebar-link">4.JS手写题</a></li><li><a href="/front-base-know-blog/know/5.css.html" class="sidebar-link">5.CSS</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>八股</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-base-know-blog/know/八股/1.计算机网络.html" class="sidebar-link">1.计算机网络</a></li><li><a href="/front-base-know-blog/know/八股/2.Git.html" class="sidebar-link">2.Git</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-base-know-blog/know/框架/1.vue.html" class="sidebar-link">1.vue | 主流方案对比</a></li><li><a href="/front-base-know-blog/know/框架/2.react.html" class="sidebar-link">2.react</a></li><li><a href="/front-base-know-blog/know/框架/3.ssr.html" class="sidebar-link">3.ssr</a></li><li><a href="/front-base-know-blog/know/框架/4.微前端.html" class="sidebar-link">4.微前端</a></li><li><a href="/front-base-know-blog/know/框架/5.vue3.html" class="sidebar-link">5.vue3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>优化 | 工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-base-know-blog/know/优化/3.性能优化和安全.html" class="sidebar-link">3.性能优化与安全</a></li><li><a href="/front-base-know-blog/know/优化/6.webpack.html" class="sidebar-link">6.webpack</a></li><li><a href="/front-base-know-blog/know/优化/7.算法.html" class="sidebar-link">7.实用算法 | 设计模式</a></li><li><a href="/front-base-know-blog/know/优化/10.性能优化.html" class="sidebar-link">10.性能优化</a></li><li><a href="/front-base-know-blog/know/优化/11.组件库构造.html" class="sidebar-link">11.组件库构建</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">2.1 JavaScript基础</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="_2-1-javascript基础"><a href="#_2-1-javascript基础" class="header-anchor">#</a> 2.1 JavaScript基础</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_2-1-后续">2.1 后续</a><ul><li><a href="#_2-1-41-数组分块">2.1.41 数组分块</a></li><li><a href="#_2-1-42-beacon-api-异步发送数据">2.1.42 Beacon API(异步发送数据)</a></li><li><a href="#_2-1-43-setinterval-settimeout-误差">2.1.43 setInterval | setTimeout | 误差</a></li><li><a href="#_2-1-43-pwa-service-worker">2.1.43 PWA |  service worker</a></li><li><a href="#_2-1-45-v8-垃圾回收">2.1.45 v8 | 垃圾回收</a></li><li><a href="#_2-1-46-esc-上下文-作用域链-scope-ao-vo-this">2.1.46  esc |上下文 | 作用域链（scope），AO/VO，this</a></li><li><a href="#_2-1-46-递归-和-栈溢出优化-尾递归优化-淦">2.1.46 递归 和 栈溢出优化 | 尾递归优化（淦）</a></li><li><a href="#_2-1-47-blob-file-filereader-object-url-base64">2.1.47 blob | file | fileReader | object url | base64</a></li><li><a href="#_2-1-48-拖拽事件">2.1.48 拖拽事件</a></li><li><a href="#_2-1-49-js-逆向">2.1.49 js 逆向</a></li><li><a href="#_2-1-50-错误处理">2.1.50 错误处理</a></li><li><a href="#_2-1-51-keep-alive-原理">2.1.51 keep alive 原理</a></li><li><a href="#_2-1-52-并发-idle">2.1.52  并发 | idle</a></li><li><a href="#_2-1-53-有dtd-document-documentelement-无document-body">2.1.53 有DTD document.documentElement | 无document.body</a></li><li><a href="#_2-1-54-栈-容器-堆-房间-闭包原理">2.1.54 栈(容器)  | 堆(房间) |  闭包原理</a></li><li><a href="#_2-1-55-v8-垃圾回收">2.1.55 v8 垃圾回收</a></li><li><a href="#_2-1-56-v8-的-进程-线程">2.1.56 v8 的 进程 线程</a></li><li><a href="#_2-1-57-fragment">2.1.57 fragment</a></li><li><a href="#_2-1-58-浏览器一帧内做了什么">2.1.58 浏览器一帧内做了什么</a></li><li><a href="#_2-1-59-settimeout-和-setinterval的第三个参数">2.1.59 settimeout 和 setinterval的第三个参数</a></li><li><a href="#_2-1-60-锚点导航-scrollintoview">2.1.60 锚点导航 | scrollIntoView</a></li><li><a href="#_2-1-61-控制光标位置-setselectionrange">2.1.61 控制光标位置 |  setSelectionRange</a></li><li><a href="#_2-1-62-画中画-pictureinpicture">2.1.62 画中画  |   PictureInPicture</a></li><li><a href="#_2-1-63-xhr-发送-new-open-send-onreadystatechange">2.1.63 xhr 发送 | new open send onreadystatechange</a></li><li><a href="#_2-1-64-prototype-函数扩展-可以扩展字符串">2.1.64 prototype | 函数扩展 | 可以扩展字符串</a></li><li><a href="#_2-1-65-数据埋点-用户-性能-白屏-渲染时间">2.1.65 数据埋点 | 用户 | 性能(白屏 渲染时间)</a></li><li><a href="#_2-1-66-剪切板">2.1.66 剪切板</a></li><li><a href="#_2-1-67-事件冒泡">2.1.67 事件冒泡</a></li><li><a href="#_2-1-68-map-weakmap">2.1.68 map | weakmap</a></li><li><a href="#_2-1-69-length-bug-码元是小一点-substring-bug">2.1.69 length  | bug | 码元是小一点 | substring bug</a></li><li><a href="#_2-1-70-class-内-私有字段-静态变量-类静态初始化">2.1.70 class 内 | 私有字段 | 静态变量 | 类静态初始化</a></li><li><a href="#_2-1-71-worker-优化">2.1.71 worker | 优化</a></li></ul></li></ul></div><p></p> <h2 id="_2-1-后续"><a href="#_2-1-后续" class="header-anchor">#</a> 2.1 后续</h2> <p>cv</p> <h3 id="_2-1-41-数组分块"><a href="#_2-1-41-数组分块" class="header-anchor">#</a> 2.1.41 数组分块</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">chunk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span>count</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res
<span class="token punctuation">}</span>

<span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">chunk</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-1-42-beacon-api-异步发送数据"><a href="#_2-1-42-beacon-api-异步发送数据" class="header-anchor">#</a> 2.1.42 Beacon API(异步发送数据)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>过去，许多网站使用 unload 或 beforeunload 事件以在会话结束时发送统计数据。然而这是不可靠的，在许多情况下（尤其是移动设备）浏览器不会产生 unload、beforeunload 或 pagehide 事件

<span class="token comment">//数据埋点接收数据后端示例：https://gitee.com/Electrolux/mock-receive-server</span>
<span class="token operator">--</span><span class="token number">1.</span>只能post请求
<span class="token operator">--</span><span class="token number">2.</span>最大  <span class="token number">65536</span> 字符。
<span class="token keyword">let</span> data <span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;ceshi&quot;</span><span class="token punctuation">}</span>
<span class="token comment">//window.navigator.sendBeacon('http://localhost:8088/post', data);</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'visibilitychange'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">logData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>visibilityState <span class="token operator">===</span> <span class="token string">'hidden'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8088/post'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// </span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Berwin'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8088/post'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>let formData = new FormData();
formData.append('text', '测试');
navigator.sendBeacon(&quot;&quot;, formData);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-1-43-setinterval-settimeout-误差"><a href="#_2-1-43-setinterval-settimeout-误差" class="header-anchor">#</a> 2.1.43 setInterval | setTimeout | 误差</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>出现原因：
setInterval、setTimeout实现都会出现误差，这源于js的单线程。
他们的回调函数并不是到时后立即执行，而是等系统计算资源空闲下来后才会执行。
setInterval、setTimeout都属于宏任务。

<span class="token operator">--</span><span class="token number">2.</span>解决方法：
在定时器开始前和运行时动态获取当前时间，用settimeout来替代setinterval


<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>interval <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//误差时间</span>
<span class="token keyword">var</span> nextTime <span class="token operator">=</span> interval <span class="token operator">-</span> offset<span class="token punctuation">;</span><span class="token comment">//原本间隔时间 - 误差时间</span>
<span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>doFunc<span class="token punctuation">,</span>nextTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">doFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    count<span class="token operator">++</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> count <span class="token operator">*</span> interval<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'ms'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     offset <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> count <span class="token operator">*</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nextTime <span class="token operator">=</span> interval <span class="token operator">-</span> offset<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> nextTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>doFunc<span class="token punctuation">,</span>nextTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_2-1-43-pwa-service-worker"><a href="#_2-1-43-pwa-service-worker" class="header-anchor">#</a> 2.1.43 PWA |  service worker</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>定义：
fcm 不能启动意味着消息推送
移动端 安装 pwa应用需要 梯子（md。极大的心智负担）
本质安装这个就是 一个chrome_proxy。另外这个东西在手机端吃
渐进式 web 应用（Progressive Web App）
渐进式 web 应用 就是 实现了和原生应用相近的用户体验的网页应用

Service Worker 是浏览器和网络之间的虚拟代理。 运行在一个与 页面的 JavaScript 主线程 独立的线程上，它没有对 <span class="token constant">DOM</span> 结构的访问权限，可以在不同上下文间 发送<span class="token operator">/</span>接收 信息。因为强大，所以 Service Workers 只能在安全的上下文中执行（即 <span class="token constant">HTTPS</span> ）

<span class="token operator">--</span><span class="token number">2.</span>示例：  
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;serviceWorker&quot;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 浏览器支持 Service Worker</span>
    navigator<span class="token punctuation">.</span>serviceWorker
      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;serviceWorker.js&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 这里可以接受第二个参数，用于设置 scope 范围</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果存放在网站根路径下，将会收到该网站的所有 fetch 事件</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceWorker注册成功: &quot;</span><span class="token punctuation">,</span> registration<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ServiceWorker注册失败: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token operator">--</span><span class="token number">3.</span>局限：
遇到的阻碍：
第一个是腾讯，微信<span class="token operator">/</span><span class="token constant">QQ</span>——微信<span class="token operator">/</span><span class="token constant">QQ</span>拥有最大的用户群，腾讯要推自家小程序，它不支持<span class="token constant">PWA</span>就难搞，一个商业app很难无视腾讯背后的流量（除了阿里）。
第二个，国内浏览器对<span class="token constant">PWA</span>支持很差，连百度查到的chrome下载，长久以来一直都是停留在很古老版本。
第三个阻碍，国内的<span class="token constant">GCM</span><span class="token operator">/</span><span class="token constant">FCM</span> 基本无法用，其它厂商对web push实现很乱

Google为安卓准备了基于Google服务的<span class="token constant">GCM</span><span class="token operator">/</span><span class="token constant">FCM</span>推送服务，<span class="token constant">APP</span>不需要驻留后台，只需要接入到<span class="token constant">GCM</span><span class="token operator">/</span><span class="token constant">FCM</span>中，<span class="token constant">APP</span>就可以借助Google服务器直接向安卓机推送消息。

<span class="token operator">--</span><span class="token number">4.</span>链式启动是如何解决<span class="token constant">APP</span>推送问题的<span class="token operator">?</span>

<span class="token constant">APP</span>驻留后台很容易被系统挂城墙
此景此境下，<span class="token constant">APP</span>们只能抱团取暖了——既然单个<span class="token constant">APP</span>很难停留在后台，那么<span class="token constant">APP</span>之间相互唤起，那就容易多了！开启一个<span class="token constant">APP</span>后，就拉起另一个抱团的<span class="token constant">APP</span><span class="token function">，那大家的进程都激活了，推送服务也就顺理成章。</span><span class="token punctuation">(</span>大部分的链式唤醒，都是由于<span class="token constant">APP</span>们接入了同样的推送<span class="token constant">SDK</span>。那么为什么会有这个apk呢？
国内<span class="token constant">APP</span>们想要实现推送功能，需要借助第三方的推送<span class="token constant">SDK</span>例如开发者熟知的友盟、极光、个推等等<span class="token punctuation">)</span>

<span class="token operator">--</span><span class="token number">4.</span>开发过程可以在application 中的service workers 和 cache storage去查看
生命周期 
install
activate（清理比较key）
fetch （自定义缓存）
更新我们要用 cacheName

<span class="token operator">--</span><span class="token number">5.</span> 什么是CacheStorage？
CacheStorage是浏览器中的一种存储机制，用于存储和检索网络请求和响应。它以Request 为key，Response为value去存储请求和响应对象

CacheStorage不是Service Worker <span class="token constant">API</span>，但它使<span class="token constant">SW</span>能够缓存网络响应，以便在用户断开与网络的连接时提供脱机功能。

<span class="token operator">--</span><span class="token number">6.</span>有哪些Service Worker能做但是web worker不能的？

Web Workers——为Web内容提供在后台线程中运行脚本的简单方法。工作线程可以在不干扰用户界面的情况下执行任务。此外，它们还可以使用XMLHttpRequest执行<span class="token constant">I</span><span class="token operator">/</span><span class="token constant">O</span>（尽管responseXML和channel属性始终为空）。创建后，工作人员可以通过将消息发布到该代码指定的事件处理程序中来向创建该代码的JavaScript代码发送消息（反之亦然）。
Service Worker——本质上是充当位于Web <span class="token function">app与浏览器和网络（如果可用）之间的代理服务器。它们旨在（除其他外）创建有效的脱机体验，拦截网络请求并根据网络是否可用以及服务器上是否存在更新的资产</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span>来采取适当的操作。它们还允许访问推送通知和后台同步<span class="token constant">API</span>。


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>serveice worker 生命周期</p> <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d26737a3c0754b4da1e068432657306b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp"> <h4 id="_2-1-43-1-manifest-json"><a href="#_2-1-43-1-manifest-json" class="header-anchor">#</a> 2.1.43.1 manifest.json</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>使用<span class="token constant">PWA</span>很简单，只需要在<span class="token constant">HTML</span>中的head中使用link标签引用一个manifest<span class="token punctuation">.</span>json文件即可<span class="token punctuation">.</span>点击底部工具栏的<span class="token constant">JSON</span> 选择 json <span class="token keyword">with</span> comments
<span class="token punctuation">{</span>
  <span class="token comment">// 应用的名称</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Electrolux_pwa_demo&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 简称</span>
  <span class="token string-property property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 显示模式 fullscreen（全屏） | standalone(独立) | standalone（最小化） | browser（浏览器）</span>
  <span class="token string-property property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 启动页</span>
  <span class="token string-property property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>  
  <span class="token comment">// 主题颜色</span>
  <span class="token string-property property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#313131&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 背景颜色</span>
  <span class="token string-property property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#313131&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e.png&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;256x256&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;manifest&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;manifest.json&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="_2-1-43-2-sw-js-方法"><a href="#_2-1-43-2-sw-js-方法" class="header-anchor">#</a> 2.1.43.2 sw.js 方法</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>html 的 script标签 中写入<span class="token punctuation">.</span>Add to Home Screen，即添加到主屏幕


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Script loaded!'</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * self: 表示 Service Worker 作用域, 也是全局变量
 * caches: 表示缓存
 * skipWaiting: 表示强制当前处在 waiting 状态的脚本进入 activate 状态
 * clients: 表示 Service Worker 接管的页面
 * 
 */</span>



<span class="token comment">//重要：这里定义一个key，如果变化了 那么也会变</span>
<span class="token keyword">var</span> cacheStorageKey <span class="token operator">=</span> <span class="token string">'min'</span>

<span class="token keyword">var</span> cacheList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;/pwa_demo/main.css&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/pwa_demo/e.png&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/pwa_demo/pwa-fonts.png&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment">//重点：可以在注册完成安装 Service Worker 时, 抓取静态资源写入缓存:</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Cache event!'</span><span class="token punctuation">)</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheStorageKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//写入内存 </span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Adding to Cache:'</span><span class="token punctuation">,</span> cacheList<span class="token punctuation">)</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheList<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Skip waiting!'</span><span class="token punctuation">)</span>
      <span class="token comment">//skipwaiting为了在页面更新的过程当中,</span>
      <span class="token comment">// 新的 Service Worker 脚本能立即激活和生效。</span>
      <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//重要：更新静态资源 可以遍历所有的缓存名称逐一判断决决定是否清除</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Activate event'</span><span class="token punctuation">)</span>
  e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sdsd&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// Promise.all(</span>
    <span class="token comment">//   caches.keys().then(cacheNames =&gt; {</span>
    <span class="token comment">//     return cacheNames.map(name =&gt; {</span>
    <span class="token comment">//       if (name !== cacheStorageKey) {</span>
    <span class="token comment">//         return caches.delete(name)</span>
    <span class="token comment">//       }</span>
    <span class="token comment">//     })</span>
    <span class="token comment">//   })</span>
    <span class="token comment">// ).then(() =&gt; {</span>
    <span class="token comment">//   console.log('Clients claims.')</span>
    <span class="token comment">//   //在新安装的 Service Worker 中通过调用 self.clients.claim() </span>
    <span class="token comment">//   //取得页面的控制权, 这样之后打开页面都会使用版本更新的缓存。</span>
    <span class="token comment">//   //旧的 Service Worker 脚本不再控制着页面之后会被停止</span>
    <span class="token comment">//   return self.clients.claim()</span>
    <span class="token comment">// })</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//重要：处理动态缓存</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log('Fetch event:', e.request.url)</span>
  e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Using cache for:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        <span class="token keyword">return</span> response
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Fallback to fetch:'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//重要：消息推送</span>

<span class="token comment">// self.showNotification('Hello World!', {</span>
<span class="token comment">//   body: 'This is a notification!',</span>
<span class="token comment">//   icon: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/703a0cee8b0b494eadd27adc61883956~tplv-k3u1fbpfcp-watermark.image?',</span>
<span class="token comment">//   actions: [{</span>
<span class="token comment">//       action: 'yes',</span>
<span class="token comment">//       title: 'Yes'</span>
<span class="token comment">//   }, {</span>
<span class="token comment">//       action: 'no',</span>
<span class="token comment">//       title: 'No'</span>
<span class="token comment">//   }]</span>
<span class="token comment">// });</span>

<span class="token comment">// self.addEventListener('notificationclick', (event) =&gt; {</span>
<span class="token comment">//   // 判断点击的是哪个按钮</span>
<span class="token comment">//   if (event.action === 'yes') {</span>
<span class="token comment">//       console.log('yes');</span>
<span class="token comment">//   } else if (event.action === 'no') {</span>
<span class="token comment">//       console.log('no');</span>
<span class="token comment">//   }</span>
<span class="token comment">// });</span>




</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><h4 id="_2-1-43-3-html方法"><a href="#_2-1-43-3-html方法" class="header-anchor">#</a> 2.1.43.3 html方法</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code>在安装Service Worker且用户转至其他页面或刷新当前页面后，Service Worker将开始接收fetch事件


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Electrolux demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Content-Type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/html; charset=utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, user-scalable=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pwa_demo/manifest.json<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pwa_demo/main.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pwa_demo/e.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image/png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>revision<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/pwa_demo/pwa-fonts.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main-text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    Electrolux demo 示例
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>network-message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    Network:
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>network-status<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Good<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>notifications<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">addToDesktop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>安装<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>




  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//这里是进行sw.js 离线缓存的设置，注册service worker</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/pwa_demo/sw.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">registration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Registered events at scope: '</span><span class="token punctuation">,</span> registration<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'./data.json'</span><span class="token punctuation">)</span>

    <span class="token keyword">var</span> statusEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#network-status'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      statusEl<span class="token punctuation">.</span>classList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'is-offline'</span><span class="token punctuation">]</span>
      statusEl<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'Offline'</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">

    <span class="token comment">//首先进行授权</span>
    Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> <span class="token string">'granted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;已经授权&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    
    <span class="token keyword">var</span> deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听beforeinstallprompt事件，该事件在网站满足PWA安装条件时触发，保存安装事件</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 监听appinstalled事件，该事件在用户同意安装后触发，清空安装事件</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 手动触发PWA安装</span>
    <span class="token keyword">function</span> <span class="token function">addToDesktop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
        deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h3 id="_2-1-45-v8-垃圾回收"><a href="#_2-1-45-v8-垃圾回收" class="header-anchor">#</a> 2.1.45 v8 | 垃圾回收</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>简单说一下原理
首先js因为是单线程，垃圾回收会占用主线程，导致页面卡顿，所以需要一个算法或者说策略

而v8采用的是分代式回收，回收主要表现在新老生代上，新生代就活得短一点的对象，老生代就活得长一点的对象。
“在新生代里有一个算法，将新生代分成了两个区，一个form<span class="token punctuation">,</span>一个to，每次经过Scavenge会将form区中的没引用的销毁，然后活着的to区调换到form，反复如此，当经过一次acavange后就会晋升的老生代还有个条件就是<span class="token constant">TO</span>区的内存超过<span class="token number">25</span>也会晋升。”
“而老生代，采用标记清除和标记整理，但标记清除会造成内存不连续，所以会有标记整理取解决掉内存碎片，就是清理掉边界碎片”

<span class="token operator">--</span><span class="token number">2.</span>为什么<span class="token constant">TO</span>超过<span class="token number">25</span><span class="token operator">%</span>要晋升老生代？
为了不影响后续<span class="token constant">FORM</span>空间的分配<span class="token punctuation">.</span>

<span class="token operator">--</span><span class="token number">3.</span>标记清除是怎么清除的？
垃圾回收会构建一个根列表，从根节点去访问那些变量，可访问到位活动，不可就是垃圾
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2-1-46-esc-上下文-作用域链-scope-ao-vo-this"><a href="#_2-1-46-esc-上下文-作用域链-scope-ao-vo-this" class="header-anchor">#</a> 2.1.46  esc |上下文 | 作用域链（scope），AO/VO，this</h3> <p>this有<strong>默认</strong>，<strong>隐式</strong>，显式（bind，call），new</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">0.</span>上下文和作用域链的主要区别是 
<span class="token operator">--</span><span class="token number">0.1</span> 作用域是静态的，上下文是js开始执行创造的（有栈的操作）
<span class="token operator">--</span><span class="token number">0.2</span> 上下文是作用域的有作用域的差别




<span class="token operator">--</span><span class="token number">1.</span>上下文：执行环境
<span class="token operator">--</span><span class="token number">1.1</span> 全局执行上下文 ： 不在任何函数中的代码都位于全局执行上下文中
<span class="token operator">--</span><span class="token number">1.2</span> 函数执行上下文
<span class="token operator">--</span><span class="token number">1.3</span> eval
<span class="token number">1.3</span> 生命周期：
<span class="token operator">--</span><span class="token number">1.3</span><span class="token number">.1</span> 创建阶段 （三件事）
创建变量对象：首先初始化函数的参数 arguments（<span class="token constant">VO</span>的开始 value还没有赋值。 然后进入执行阶段会变成<span class="token constant">AO</span><span class="token operator">-</span>活动对象），提升函数声明和变量声明
创造作用域链：找到最近变量就停止
确定<span class="token keyword">this</span>
<span class="token operator">--</span><span class="token number">1.3</span><span class="token number">.2</span> 执行阶段（三件事）
 变量赋值
 函数引用
 执行代码
<span class="token operator">--</span><span class="token number">1.3</span><span class="token number">.3</span>回收阶段
函数执行完毕后出栈，对应的执行上下文也出栈

<span class="token number">1.4</span> 注意：
<span class="token operator">--</span><span class="token number">1.4</span><span class="token number">.1</span> 全局执行上下文在代码开始执行时就创建，有且只有一个，永远在执行上下文栈的栈底，浏览器窗口关闭时它才出栈
<span class="token operator">--</span><span class="token number">1.4</span><span class="token number">.2</span> 函数调用的时候入栈出栈



<span class="token operator">--</span><span class="token number">2.</span>作用域：
<span class="token operator">--</span><span class="token number">2.1</span> 全局作用域
<span class="token operator">--</span><span class="token number">2.2</span> 函数作用域
<span class="token operator">--</span><span class="token number">2.3</span> 块级作用域


<span class="token operator">--</span><span class="token number">3.</span><span class="token constant">VO</span>过程
<span class="token operator">--</span><span class="token number">3.1</span> 创造arguments对象
<span class="token operator">--</span><span class="token number">3.2</span> 检查<span class="token keyword">function</span>
<span class="token operator">--</span><span class="token number">3.3</span> 检查 <span class="token keyword">var</span> ：如果 <span class="token keyword">var</span> 定义变量的时候发现已有同名函数定义则跳过变量定义

<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>  这样不会报错，并且执行会执行最后一个
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">56</span> 会报错
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>


“算了我以一个函数来说把，主要是创建和执行。假设有一个<span class="token constant">A</span>函数，过程是这样的创建全局执行上下文、压入esc、全局上下文初始化、执行<span class="token constant">A</span>函数、创建<span class="token constant">A</span>函数执行上下文，压入esc，<span class="token constant">A</span>函数上下文初始化，这个初始化过程是这样的：创建作用域链、emm我上面提漏了一个<span class="token constant">A</span>函数被创建全局上下文被保存到scope中的过程，是复制scpoe创建作用域链<span class="token punctuation">,</span>用arguments创建活动对象，初始化活动对于，将活动对象压入链顶，执行完毕，上下文弹出。”

“但是全局上下文一直在栈底，而<span class="token constant">VO</span>和<span class="token constant">AO</span>的确认，我感觉是取决是是否可访问的。”

“而闭包就是上下文链中上下文scope被销毁了，但因为保持了对scope中某个变量的引用，这应该就是你上面说的回收原理的根节点实现的这个东西把，导致没销毁干净，留存在了内存中，完成了闭包”


<span class="token operator">--</span><span class="token number">4.</span> 题目（vo声明，执行上下文）
注意：函数声明提升更加靠前
<span class="token operator">--</span><span class="token number">4.1</span> <span class="token keyword">let</span> 不能变量提升
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//直接报错</span>

<span class="token operator">--</span><span class="token number">4.2</span> 如果 <span class="token keyword">var</span> 定义变量的时候发现已有同名函数定义则跳过变量定义，不做变量提升
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//foo2 foo1</span>


<span class="token operator">--</span><span class="token number">4.3</span> 跟上面一样
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//foo2 foo1</span>



<span class="token operator">--</span><span class="token number">4.3</span>  只有<span class="token keyword">var</span> 的变量提升
<span class="token keyword">var</span> foo2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> foo2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefine,10</span>

<span class="token operator">--</span><span class="token number">4.4</span>  变量没有提升，这里是考察作用域
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><h3 id="_2-1-46-递归-和-栈溢出优化-尾递归优化-淦"><a href="#_2-1-46-递归-和-栈溢出优化-尾递归优化-淦" class="header-anchor">#</a> 2.1.46 递归 和 栈溢出优化 | 尾递归优化（淦）</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>尾递归优化：防止全局上下文的爆栈，函数的最后一步是返回一个函数的运行结果

<span class="token keyword">function</span> <span class="token function">recursion</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> num<span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">recursion</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> num<span class="token punctuation">;</span>
<span class="token punctuation">}</span>   优化后
<span class="token keyword">function</span> <span class="token function">recursion</span> <span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token function">recursion</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> sum <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  <span class="token comment">//也是报错</span>
<span class="token function">recursion</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 50005000</span>

尾调用由于是函数的最后一步操作，所以不需要保留外层函数的相关信息，因为调用位置、内部变量等信息都不会再用到了，只要直接用内层函数的调用记录，取代外层函数的调用记录就可以了，这样一来，运行尾递归函数时，执行栈永远只会新增一个上下文。

其实，尾递归优化这种东西，现在没有任何一个浏览器是支持的（据说 Safari <span class="token number">13</span> 是支持的）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-1-47-blob-file-filereader-object-url-base64"><a href="#_2-1-47-blob-file-filereader-object-url-base64" class="header-anchor">#</a> 2.1.47 blob | file | fileReader | object url | base64</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1</span><span class="token punctuation">.</span>blob 对象
branary large object 二进制大数据，可以读取，不能修改。console<span class="token punctuation">.</span>log控制台输出的是size还有一个type

像是分块上传分块我们可以用slice进行分块

<span class="token keyword">let</span> blobInit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">blob</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> blobHandle <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//这里后面跟着res.onload(()=&gt;{}) 也可以</span>

res<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blobHandle<span class="token punctuation">)</span>
res<span class="token punctuation">.</span>result  <span class="token comment">//输出helloworld</span>

<span class="token operator">--</span><span class="token number">2.</span> file 对象
是一个特殊的blob<span class="token punctuation">.</span><span class="token function">比blob多了一个lastmodify和name</span><span class="token punctuation">(</span>上传文件的名字<span class="token punctuation">)</span>。还有可能是fileList

<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;type&quot;</span><span class="token operator">&gt;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">--</span><span class="token number">3</span> fileReader 对象
readAsText<span class="token operator">/</span>DataURL<span class="token operator">/</span>ArrayBuffer<span class="token operator">/</span>binaryString

<span class="token keyword">let</span> reader<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//四个方法</span>
<span class="token comment">//3.1.reader.readAsText</span>
<span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
输出reader<span class="token punctuation">.</span>result

<span class="token comment">//3.2.reader.readAsDataURL</span>
<span class="token operator">&lt;</span>input type <span class="token operator">=</span> “file”<span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">//3.3读成base64格式的字符串，后面读了之后我们要</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>“<span class="token punctuation">.</span>test”<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	render<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
	reader<span class="token punctuation">.</span><span class="token function">onload</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  		e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

使用方法。url中直接输入可以显示。但是可能会不全。最好是img标签中直接输入src，然后里面直接是这个src地址


<span class="token comment">//3.4reader.readAsArrayBuffer</span>
<span class="token function">arrayBuffer也是一个黑盒对象，跟blob很像。然后有两种类型，一种是dataView，还有一个是typeBuffer</span><span class="token punctuation">(</span>里面有<span class="token number">9</span>个内容<span class="token punctuation">)</span><span class="token function">。前者有点像ts的record类型</span><span class="token punctuation">(</span>里面可以混合一堆东西），后者是单一类型

用于对二进制文件进行操作。然后blob代表的是一个整体的文件，适合用来进行传输

<span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token function">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//8个字节</span>
<span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token comment">//然后这玩意是一个数组可以直接改</span>

<span class="token keyword">let</span> test  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">dataView</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span>  <span class="token comment">//然后用set /get 来进行数组的添加和查询</span>

<span class="token comment">//3.5binaryString</span>

<span class="token operator">--</span><span class="token number">4</span><span class="token punctuation">.</span>object Url
这是一种表示file object 和 blob object的url


<span class="token operator">&lt;</span>input type <span class="token operator">=</span> “file”<span class="token operator">/</span><span class="token operator">&gt;</span>

<span class="token comment">//读成base64格式的字符串，后面读了之后我们要</span>
<span class="token keyword">let</span> object <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>“<span class="token punctuation">.</span>test”<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> render <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
	<span class="token comment">//输出的格式类似于 localhost：8080/9f9f9f9f</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token operator">--</span><span class="token number">5</span><span class="token punctuation">.</span>base64
js中有两个函数用来加密和解密base64的数据。

<span class="token function">btoa</span><span class="token punctuation">(</span>‘javascript’<span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//加密：输出 amF2Yxxxx</span>
<span class="token function">atoa</span><span class="token punctuation">(</span>‘amF2Yxxxx’<span class="token punctuation">)</span> <span class="token comment">//解密：输出javascript。</span>
一般来说用来 将canvas 变成 base64的照片（canvas元素<span class="token punctuation">.</span><span class="token function">toDataUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> ） 或者是 把图片变成base64图片（readAsDataURL） 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h3 id="_2-1-48-拖拽事件"><a href="#_2-1-48-拖拽事件" class="header-anchor">#</a> 2.1.48 拖拽事件</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">拖动的元素事件：</span><span class="token punctuation">(</span>drag ， dragstart  ，和dragend<span class="token punctuation">)</span>
拖动的目标事件（容器）：ondrop，ondropenter<span class="token operator">/</span>over<span class="token operator">/</span>leave<span class="token operator">/</span>。

拖动元素的属性要用dataTransfer对象来获取值。


<span class="token number">1.</span>拖拽单文件事件
 <span class="token operator">&lt;</span>div draggable<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;box&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
box<span class="token punctuation">.</span><span class="token function-variable function">ondragend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//拖拽到哪里就放到哪里</span>
    box<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">=</span> <span class="token string">'top:'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px;left:'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
<span class="token punctuation">}</span>

————————————————————————————
<span class="token number">2.</span>拖拽多文件事件
 <span class="token operator">&lt;</span>div draggable<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;box&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span> 
box<span class="token punctuation">.</span><span class="token function">ondragend</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> dataFiles <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files
	dataFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> fileR <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		fileR<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
		fileR<span class="token punctuation">.</span><span class="token function">onload</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			<span class="token comment">//这里就可以自由发挥了</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;type&quot;</span><span class="token operator">&gt;</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">)</span> <span class="token comment">//e.files也是有可能的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


————————————————————————

<span class="token number">3.</span> 拖拽div区域

<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;type&quot;</span><span class="token operator">&gt;</span>
<span class="token comment">//经过，只有是设置了阻止默认事件才能够解锁松开鼠标ondrop</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ondragover</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//放下</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ondrag</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//设定拖动影子的样式</span>
e<span class="token punctuation">.</span> dataTransfer<span class="token punctuation">.</span><span class="token function">setDragImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="_2-1-49-js-逆向"><a href="#_2-1-49-js-逆向" class="header-anchor">#</a> 2.1.49 js 逆向</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>防护系统：一抓包就闪退+白屏+通过用户证书直接可以用

小黄鸟不可用的原因
用户证书（安卓7之前手机相信这个） ｜ 手机只相信系统证书（ca机构）。所以我们如果没有root，那么小黄鸟就不能抓包了

解决方法：套一层虚拟机，然后用小黄鸟去监听虚拟机
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-1-49-1-网页工具"><a href="#_2-1-49-1-网页工具" class="header-anchor">#</a> 2.1.49.1 网页工具</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.2</span><span class="token number">.0</span> element

element的event listener中 。勾上 ancestor all 就可以看到全局的事件，反之只能够看到当前的事件

<span class="token number">1.2</span><span class="token number">.1</span> network

大界面打开一个preserve 和 disable cache

preserve log （打开的：界面打开一个新界面不会清除调试输出）
disable cache（打开的：就不会执行<span class="token number">304</span>，全部会重新进行请求。返回的都会变成<span class="token number">200</span>）
逆向中全部勾上就可以了

里面的表头 initator 可以查看调用栈 ｜ 有的是浏览器自己开启的
里面表头 的waterfall 是可以查看 调用的顺序

<span class="token number">1.2</span><span class="token number">.2</span> source  

资源面板：右上角三个小点打开，有一个搜索界面，点击这个在下方能够添加别的一些界面（console 之类的）。中间下面会有一段小小的格式化，中间偏右 那里

<span class="token number">1.2</span><span class="token number">.2</span><span class="token number">.1</span>左边的小面板：


<span class="token number">1</span><span class="token punctuation">.</span>page：所有的资源文件都在里面<span class="token operator">-</span>（平常我们不会去用它）

<span class="token number">2</span><span class="token punctuation">.</span>fileSystem：关联子目录

<span class="token number">3</span><span class="token punctuation">.</span>overrides：重写（可以对当前网站的js进行替换）。勾选上允许重写后（关联子目录后）。我们可以找到network的js里面，右键然后open <span class="token keyword">in</span> source panel 或者是 save <span class="token keyword">for</span> overrides<span class="token operator">-</span>有的网站兼容模式下面运行，那么overrides就不会执行。所以我们会用到极速模式来进行执行

<span class="token number">4</span><span class="token punctuation">.</span>content script：上下文的脚本

<span class="token number">5</span><span class="token punctuation">.</span>snippets 
默认是都会执行的脚本（任何事件，任何网址）


<span class="token number">1.2</span><span class="token number">.2</span><span class="token number">.2</span>右边的小面板：

勾上最后一个的pause on caught exceptioj

第一个是 奔向下一个断点
第二个是 一个一个方法的进行执行 （可以找出其中方法逻辑）
第三个是 在这个语句里面一条条 代码块运行（）
第四个是 返回到这个方法调用的位置
第五个是 跟第三个一样的，只是会在文件的开头开始运行
第六个是 可以让所有断点都失效
最后一个 don‘t pause on excetion 变蓝。把pause on caught exception 勾上。这样就可以避免<span class="token keyword">try</span> catch 进入catch而会直接报错。（要勾上）
下面的watch 可以监听，类似于console这个变量

断点可以右键移除和添加

<span class="token number">1.2</span><span class="token number">.2</span><span class="token number">.3</span> console面板

左上角可以show console sidebar：可以区分重要性
<span class="token literal-property property">然后fliter输入框可以写正则。然后可以。用类似于url</span><span class="token operator">:</span>www<span class="token punctuation">.</span>Baird<span class="token punctuation">.</span>com来进行过滤


勾上preserve log 和group similar 和 log xmlhttprequests
evaluate triggers users activation<span class="token punctuation">,</span> autocomplete from history<span class="token punctuation">,</span> eagar evalution

hide network ：隐藏<span class="token number">404</span>之类的东西
preserve log ： 是否清除缓存。（勾上就不清除缓存了）
group similar：分组（相同的会放在一起，不会展开）
eagar evalution：可以预览结果
autocomplete from history ：自动补全
evaluate triggers users activation ：一些api无法靠js触发。例如有声影片自动播放开启popup（弹窗），下载档案。这里我们之所以能够用window<span class="token punctuation">.</span>open打开是因为这个选项打开从而保持user activation。如果我们延迟5s弹出，那么就会弹出user activation警告
log xmlhttpprerequest ： 打印http请求（promise例如 <span class="token function">fetch</span><span class="token punctuation">(</span>“xx”<span class="token punctuation">)</span>）


<span class="token number">1.2</span><span class="token number">.3</span> application

这里面其实存储和缓存会比较多。简单
但是要注意这里我们说的清除缓存只是清除浏览器的缓存，但是变量的缓存是清除不掉的。例如 window<span class="token punctuation">.</span>a 清除不掉


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h4 id="_2-1-49-2-网页工具断点"><a href="#_2-1-49-2-网页工具断点" class="header-anchor">#</a> 2.1.49.2  网页工具断点</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>本地进行js 请求，对js请求进行修改，能修改
批量监听
更智能的监听

<span class="token number">1.3</span><span class="token number">.1</span> 断点

<span class="token constant">DOM</span> 断点：什么时候渲染的数据（渲染页面改变出来某一个数据）<span class="token operator">-</span>无法根据栈快速定位<span class="token operator">-</span>我们可以通过element 的鼠标 右键 直接在 element上面 直接添加breakpoint

<span class="token constant">DOM</span>事件断点：什么时候进行的事件（点击事件的断点）<span class="token operator">-</span>跟上一个差不多。我们可以在element中 eventlistener 中不选择 ancestor all 然后就可以定位到代码的位置 然后就可以手动下断

<span class="token constant">XHR</span> 断点 ： 进行事件请求的断点 （）<span class="token operator">-</span> 距离加密（逆向的目标）函数比较近，可以直接看到栈调用<span class="token operator">-</span>具体来说是我们从后往前复制公用的部分。然后我们在source中的xhr中 add url我们 添加  公用的部分就可以打断点了（数字广东的朋友问过我这个问题）

代码行断点 ：手动断点<span class="token operator">-</span>代码前点一下就会变成绿色

代码断点 ：<span class="token keyword">debugger</span>

全局事件断点：浏览器事件断点（source的 最右边进行断点操作）

异常捕获断点：source的最右边点击蓝色 然后 pause on caught exception勾上。不想断的地方右键选择这个断点然后edit 填入<span class="token boolean">false</span>

<span class="token keyword">debugger</span>

<span class="token number">1.3</span><span class="token number">.2</span> 方法栈 ｜ 跟值

这里是基于xhr ，我们在 source中 找到xhr 事件，然后我们找到request url，找到xhr

首先的跟值就是 点一下ctrl 我们就可以找到这个函数的结构（直到没有智能提示我们就可以确定这个是函数的开始）。找到xhr中的open函数


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_2-1-50-错误处理"><a href="#_2-1-50-错误处理" class="header-anchor">#</a> 2.1.50 错误处理</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1</span><span class="token punctuation">.</span>throw <span class="token function">Expressions</span> <span class="token punctuation">(</span>stage <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported encoding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">--</span><span class="token number">2</span><span class="token punctuation">.</span>Promise<span class="token punctuation">.</span>try  可以更加精确的捕获同步错误。
里面抛出的错误能够被捕获
<span class="token keyword">function</span> <span class="token function">getUserNameById</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">try</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> id <span class="token operator">!==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;id must be a number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> user<span class="token punctuation">.</span>name
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">--</span><span class="token number">3</span><span class="token punctuation">.</span>Error Cause

就是<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload job result failed'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">cause</span><span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
然后 是使用 。相当于他会帮你自定义一个类型出来
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">doJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Caused by'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Error: Upload job result failed</span>
<span class="token comment">// Caused by TypeError: Failed to fetch</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_2-1-51-keep-alive-原理"><a href="#_2-1-51-keep-alive-原理" class="header-anchor">#</a> 2.1.51 keep alive 原理</h3> <p>不会生成真正的DOM节点，并且能够缓存组件</p> <p>最简单就是使用display:none来将 这个dom隐藏。但是这种方法并没有做到dom真正的移除，又让组件没有被销毁</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>要实现这个我们必须要依赖虚拟dom，也就是说我们要手写框架？

document<span class="token punctuation">.</span>createElement 在内存中创建一个元素，然后再通过 React<span class="token punctuation">.</span>createPoral 把 React 子节点渲染到这个元素上。如果不满足的我们会用ref来移除这个元素

在react中 我们可以用 portal 和ref 来进行控制，具体代码如下

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Conditional</span> <span class="token operator">=</span> <span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>targetElement<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> containerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      containerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        containerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>active<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span>containerRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span>ReactDOM<span class="token punctuation">.</span><span class="token function">createPortal</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>children<span class="token punctuation">,</span> targetElement<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span>Conditional active<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">!</span>shouldHide<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Foo<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Conditional<span class="token operator">&gt;</span>

缺点：需要手动控制 active ，不能直接基于子组件销毁<span class="token operator">/</span>创建的生命周期事件

缺少失活<span class="token operator">/</span>激活的生命周期时间，子组件无法感知自己是不是被缓存起来了

依赖了 ReactDOM ，对 <span class="token constant">SSR</span> 不够友好
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="_2-1-52-并发-idle"><a href="#_2-1-52-并发-idle" class="header-anchor">#</a> 2.1.52  并发 | idle</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>js并发：
<span class="token number">1</span><span class="token punctuation">.</span>nginx里面合并前端请求 nginx<span class="token operator">-</span>http<span class="token operator">-</span>concat。或者阿里的tengine，它也能够合并前端请求
<span class="token number">2.</span>缓存 
<span class="token number">3.</span>请求数，资源供给，请求分流 
<span class="token number">4.</span>压缩传输 
<span class="token number">5.</span>读写分离
<span class="token number">6</span><span class="token punctuation">.</span>promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>两个或者三个请求<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>两个或者三个请求<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">7.</span> createDocumentFragment <span class="token operator">|</span> <span class="token keyword">async</span> 和 defer <span class="token operator">|</span> temple
<span class="token number">8.</span> requestIdleCallback：
16ms之后requestIdleCallback 里注册的任务。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-1-53-有dtd-document-documentelement-无document-body"><a href="#_2-1-53-有dtd-document-documentelement-无document-body" class="header-anchor">#</a> 2.1.53 有DTD document.documentElement | 无document.body</h3> <h3 id="_2-1-54-栈-容器-堆-房间-闭包原理"><a href="#_2-1-54-栈-容器-堆-房间-闭包原理" class="header-anchor">#</a> 2.1.54 栈(容器)  | 堆(房间) |  闭包原理</h3> <p>https://www.zhihu.com/question/482433315/answer/2083349992</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>定义
v8默认的栈区大小为984KB
注意：在不同时期，不同操作系统中<span class="token constant">V8</span>对于字符串大小的限制并不相同。大概有个范围是256MiB ～ 1GiB

<span class="token function">栈像个容器，容量小速度快</span><span class="token punctuation">(</span>基本类型<span class="token punctuation">)</span>
<span class="token function">堆像个房间，容量较大</span><span class="token punctuation">(</span>引用类型<span class="token punctuation">)</span><span class="token punctuation">,</span>但是引用类型的引用（变量）还是存在栈内存中的

通过引用到堆中查找实际对象

<span class="token operator">--</span><span class="token number">2.</span>为什么 引用对象放在堆里面。基本数据类型放在栈里面？
栈是占用固定空间，先进后出。在变量使用完成后就可以将其释放，内存回收容易实现。
堆是动态分配内存。先进先出。只有引用他的变量不存在的时候才会被垃圾机制回收

<span class="token operator">--</span><span class="token number">3.</span>既然引用对象放在堆里面。基本数据类型放在栈里面？那么针对于太大的基本字符串，js引擎会怎么做？

在栈内存不下，只能存在字符串常量池中，如果是 <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">&quot;78&quot;</span> 的形式<span class="token punctuation">.</span>那么就是在栈中 的变量进行引用。如果是 <span class="token keyword">let</span> a <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;78&quot;</span><span class="token punctuation">)</span> 那么就会在堆中进行引用

注意一下特例：字符串的缓存：v8内部有一个名为stringTable的hashmap会缓存所有字符串。会根据其特征换算为一个hash值，通过hash的key比对来实现缓存。如果不存在我们才会存到长两次然后把地址付给变量。这也是<span class="token constant">V8</span>中的字符串都是不可变的原因

字符串拼接做了哪些操作？
这里如果内容相同，地址就会不一样。这一点注意一下

<span class="token operator">--</span><span class="token number">4.</span>数字的分配和内存改变的机制：
<span class="token number">42</span> 会被当成Smi
数字在<span class="token constant">V8</span>中分为 smi 和 heapNumber：heapNumber 类似字符串 不可变

<span class="token operator">--</span><span class="token number">5.</span>总结
数字： 小整数存在栈中，其他类型存在堆中。
字符串： 存在堆里，栈中为引用地址，如果存在相同字符串，则引用地址相同。
boolean 在栈中


js engine 是c 开发的。栈区（stack） 由编译器自动分配释放。堆区（heap）一般由程序员分配释放，使用 malloc 或 <span class="token keyword">new</span> 等。偏偏 不再经过 <span class="token constant">C</span><span class="token operator">/</span><span class="token constant">C</span><span class="token operator">++</span> 编译器编译，具体 <span class="token constant">JS</span> 变量类型，也被拆分为具体实现 Engine 的Native Code 变量类型


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">deepclone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// step1:过滤function</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!=</span><span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token comment">// step2:初始变量</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment">// step3 : for in赋值</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
       arr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepclone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>


<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">first</span><span class="token operator">:</span><span class="token string">&quot;xiaoming&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">fun</span><span class="token operator">:</span><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">deepclone</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token function">deepclone</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b<span class="token punctuation">.</span>name<span class="token punctuation">.</span>first <span class="token operator">=</span> <span class="token number">5</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_2-1-55-v8-垃圾回收"><a href="#_2-1-55-v8-垃圾回收" class="header-anchor">#</a> 2.1.55 v8 垃圾回收</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>栈内存和堆内存垃圾回收方式不同。

<span class="token operator">--</span><span class="token number">1.</span>栈内存的回收：调用栈上下文切换后回收栈内存，比较简单
<span class="token operator">--</span><span class="token number">2.</span>堆内存回收：<span class="token constant">V8</span>的堆内存分为新生代内存和老年代内存。
<span class="token operator">--</span><span class="token number">2.1</span>新生代内存是临时分配的内存，存在时间短
有两个部分 from 和 to， 
Scavenge先扫描 from ，清理一次非存活对象。 存活的复制到to
然后 交换 from 和 to。to超过<span class="token number">25</span><span class="token operator">%</span>要晋升老生代

<span class="token operator">--</span><span class="token number">2.2</span>老年代内存存在时间长
<span class="token operator">--</span><span class="token number">2.2</span><span class="token punctuation">.</span>1Promotion：新生代比较长命的回到老生代，
<span class="token operator">--</span><span class="token number">2.2</span><span class="token number">.2</span>回收主要是标记清除
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2-1-56-v8-的-进程-线程"><a href="#_2-1-56-v8-的-进程-线程" class="header-anchor">#</a> 2.1.56 v8 的 进程 线程</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>后新开一个页面至少需要：
<span class="token operator">--</span><span class="token number">1.</span>浏览器进程（brower）：地址栏、书签、前进后退按钮
<span class="token operator">--</span><span class="token number">2.</span><span class="token constant">GPU</span>进程：3D <span class="token constant">CSS</span>，进程渲染
<span class="token operator">--</span><span class="token number">3.</span>网络进程（http）：发起和接受网络请求
<span class="token operator">--</span><span class="token number">4.</span>渲染进程（render）：将<span class="token constant">HTML</span>、<span class="token constant">CSS</span>、<span class="token constant">JS</span>转为用户可以与之交互的网页
<span class="token operator">--</span><span class="token number">4.1</span>   <span class="token constant">GUI</span> 渲染线程
<span class="token operator">--</span><span class="token number">4.2</span>   JavaScript 引擎线程
<span class="token operator">--</span><span class="token number">4.3</span>   事件触发线程
<span class="token operator">--</span><span class="token number">4.4</span>   定时器触发线程
<span class="token operator">--</span><span class="token number">4.5</span>   异步http请求线程
<span class="token operator">--</span><span class="token number">5.</span>插件进程（可以有，可以没有）：防止崩溃
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-1-57-fragment"><a href="#_2-1-57-fragment" class="header-anchor">#</a> 2.1.57 fragment</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>可以把他当作一个虚拟dom。
<span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> temp  <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innrtHTML <span class="token operator">=</span> <span class="token number">56</span>
fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-1-58-浏览器一帧内做了什么"><a href="#_2-1-58-浏览器一帧内做了什么" class="header-anchor">#</a> 2.1.58 浏览器一帧内做了什么</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>input <span class="token function">events</span><span class="token punctuation">(</span>click 之类的<span class="token punctuation">)</span>
js
begin frame
<span class="token constant">RAF</span>（RequestAnimationFrame）
layout
paint
<span class="token constant">RIC</span> <span class="token punctuation">(</span>RequestIdelCallback<span class="token punctuation">)</span>：这一个只有一帧小于16ms 才会执行

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-1-59-settimeout-和-setinterval的第三个参数"><a href="#_2-1-59-settimeout-和-setinterval的第三个参数" class="header-anchor">#</a> 2.1.59 settimeout 和 setinterval的第三个参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//第三个以后的参数是作为第一个func()的参数传进去。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> j <span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span><span class="token punctuation">,</span> i<span class="token operator">*</span><span class="token number">1000</span> <span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

这样写就错了
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-1-60-锚点导航-scrollintoview"><a href="#_2-1-60-锚点导航-scrollintoview" class="header-anchor">#</a> 2.1.60 锚点导航 | scrollIntoView</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#comment &gt; div &gt; div.comment &gt; div &gt; div.comment-list &gt; div:nth-child(2) &gt; div.con &gt; p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">behavior</span><span class="token operator">:</span><span class="token string">&quot;smooth&quot;</span><span class="token punctuation">,</span><span class="token comment">// 平滑过渡</span>
    <span class="token literal-property property">block</span><span class="token operator">:</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">,</span> <span class="token comment">//垂直方向的对齐</span>
    <span class="token literal-property property">inline</span><span class="token operator">:</span><span class="token string">&quot;start&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-1-61-控制光标位置-setselectionrange"><a href="#_2-1-61-控制光标位置-setselectionrange" class="header-anchor">#</a> 2.1.61 控制光标位置 |  setSelectionRange</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> placeholder<span class="token operator">=</span><span class="token string">&quot;请输入&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-1-62-画中画-pictureinpicture"><a href="#_2-1-62-画中画-pictureinpicture" class="header-anchor">#</a> 2.1.62 画中画  |   PictureInPicture</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'enterpirtureinpirture'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'leavepirtureinpirture'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.xx&quot;</span><span class="token punctuation">)</span><span class="token operator">!==</span>pictureInPictureElement<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span>  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestPictureInPicture</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-1-63-xhr-发送-new-open-send-onreadystatechange"><a href="#_2-1-63-xhr-发送-new-open-send-onreadystatechange" class="header-anchor">#</a> 2.1.63 xhr 发送 | new open send onreadystatechange</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">ajax</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//step1 : 设置请求头</span>
    <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">//step2：设置请求方式和请求头 //true表示异步</span>
	xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//step3：请求数据</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// step4：readyState是xhr的请求状态</span>
     <span class="token comment">//状态4表示已发送请求，服务器已完成返回响应，浏览器已完成了下载响应内容。0-4都有值的</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_2-1-64-prototype-函数扩展-可以扩展字符串"><a href="#_2-1-64-prototype-函数扩展-可以扩展字符串" class="header-anchor">#</a> 2.1.64 prototype | 函数扩展 | 可以扩展字符串</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">max</span> <span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">//[ 9,3,11,6]</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
arr<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-1-65-数据埋点-用户-性能-白屏-渲染时间"><a href="#_2-1-65-数据埋点-用户-性能-白屏-渲染时间" class="header-anchor">#</a> 2.1.65 数据埋点 | 用户 | 性能(白屏 渲染时间)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>数据监控
<span class="token operator">--</span><span class="token number">1.1</span> <span class="token constant">PV</span>
<span class="token operator">--</span><span class="token number">1.2</span> 监听页面进入（load） 和 页面离开（pagehide 和 hashchange）。window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token number">1.3</span> 用户行为

<span class="token operator">--</span><span class="token number">2.</span>性能监控
<span class="token operator">--</span><span class="token number">2.1</span> 首屏加载时间
<span class="token operator">--</span><span class="token number">2.2</span> 白屏时间
<span class="token operator">--</span><span class="token number">2.3</span> 页面渲染时间
<span class="token operator">--</span><span class="token number">2.4</span> 页面交互动画完成时间
<span class="token operator">--</span><span class="token number">2.5</span> 静态资源整体下载时间
<span class="token operator">--</span><span class="token number">2.6</span> http 请求

<span class="token operator">--</span><span class="token number">3.</span>异常监控
<span class="token operator">--</span><span class="token number">3.1</span> Javascript的异常监控
<span class="token operator">--</span><span class="token number">3.2</span> 样式丢失的异常监控
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2-1-66-剪切板"><a href="#_2-1-66-剪切板" class="header-anchor">#</a> 2.1.66 剪切板</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>
navigator<span class="token punctuation">.</span>clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span><span class="token string">&quot;dsa&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;复制成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果我们想直接使用会报错</span>
<span class="token operator">--</span><span class="token number">2.</span>
创造一个文本域
oInput<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//对选择对象的值进行复制到浏览器中</span>
    document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&quot;Copy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-1-67-事件冒泡"><a href="#_2-1-67-事件冒泡" class="header-anchor">#</a> 2.1.67 事件冒泡</h3> <p>指的是在设置了事件监听器时候，会顺着dom树的结构，向上执行</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  div1
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    div2
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>div3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>;

// javascript:
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
function handleClick(event) {
  console.log(event.currentTarget.id);
}
for (let i = 1; i &lt;= 3; i++) {
  let div = document.getElementById(`div${i}`);
  div.addEventListener(&quot;click&quot;, handleClick);
}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
    
<span class="token comment">&lt;!-- 我们再点击在里面的div3的时候，会输出div3 div2 div1--&gt;</span>
 <span class="token comment">&lt;!-- 如果说要避免这一个情况可以


function handleClick(event) {
  event.stopPropagation();
  console.log(event.currentTarget.id);
}

--&gt;</span>
event.stopPropagation(); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_2-1-68-map-weakmap"><a href="#_2-1-68-map-weakmap" class="header-anchor">#</a> 2.1.68 map | weakmap</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>Map对一个对象是强引用
weakmap  是一个弱引用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-1-69-length-bug-码元是小一点-substring-bug"><a href="#_2-1-69-length-bug-码元是小一点-substring-bug" class="header-anchor">#</a> 2.1.69 length  | bug | 码元是小一点 | substring bug</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>一些 emoji 的东西的length 可能会有一点不一样

原因在于 length 的 码点 和 码元

我们将一个<span class="token number">16</span><span class="token operator">/</span><span class="token number">32</span>位的二进制编码 叫做一个码元，一个码点 可以是 一个码元 也可以是两个码元<span class="token punctuation">.</span> length 属性 返回的是 码元（小）

正确的方式是Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;xx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-1-70-class-内-私有字段-静态变量-类静态初始化"><a href="#_2-1-70-class-内-私有字段-静态变量-类静态初始化" class="header-anchor">#</a> 2.1.70 class 内 | 私有字段 | 静态变量 | 类静态初始化</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">--</span><span class="token number">1.</span>私有字段
以前是加一个_
<span class="token function">_myName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

现在可以命名成
<span class="token function">#myName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
在外面就不可以直接调用


<span class="token operator">--</span><span class="token number">2</span><span class="token punctuation">.</span>static 的 作用
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token comment">/* 1.1、实例属性，直接定义的属性，要new实例后，实例去访问的*/</span>
  name<span class="token operator">=</span> <span class="token string">&quot;tom&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">/* 1.2、静态属性（类属性），通过static开头的属性，Person类可以访问,
    不需要创建实例，实例访问不到static */</span>
  <span class="token keyword">static</span> height <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
  <span class="token comment">/* 1.3、只读属性，readonly开头的属性，只可读，不可改 ts才能用 */</span> 
  <span class="token comment">//readonly money= 1000;</span>
  <span class="token comment">/* 1.4、方法，readonly开头的属性，只可读，不可改*/</span>
  <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我能挣钱'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token number">3.</span>类静态初始化

例如
<span class="token keyword">class</span> <span class="token class-name">person</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> age <span class="token operator">=</span><span class="token number">1.2</span>
<span class="token punctuation">}</span>
可以变成
<span class="token keyword">class</span> <span class="token class-name">person</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">1.2</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="_2-1-71-worker-优化"><a href="#_2-1-71-worker-优化" class="header-anchor">#</a> 2.1.71 worker | 优化</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>worker<span class="token punctuation">.</span>js中 
接收 worker 并且进行 事件逻辑处理

<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sortData <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token operator">-</span>b
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>sortData<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

index<span class="token punctuation">.</span>html 中
<span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">&quot;worker.js&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span><span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/front-base-know-blog/know/2.0javascript基础.html" class="prev">
          2.JavaScript基础
        </a></span> <span class="next"><a href="/front-base-know-blog/know/2.2.ts.html">
          2.2. ts
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/front-base-know-blog/assets/js/app.02046710.js" defer></script><script src="/front-base-know-blog/assets/js/3.a15d85cc.js" defer></script><script src="/front-base-know-blog/assets/js/1.704023bf.js" defer></script><script src="/front-base-know-blog/assets/js/17.a24d0ce5.js" defer></script>
  </body>
</html>
