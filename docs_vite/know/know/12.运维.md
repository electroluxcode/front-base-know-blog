# 12.è¿ç»´

[[toc]]



```shell
https://mirrors.tuna.tsinghua.edu.cn/ubuntu/
```



## 12.1 docker

æ–‡æ¡£ï¼šhttps://docs.docker.com/engine/reference/commandline/run/

ä»“åº“ï¼šhttps://hub.docker.com/

### 12.1.1 åŸºç¡€

```shell
# 1. åŸºç¡€ç±»åˆ«
Imagesï¼šæ‰“åŒ…çš„é•œåƒï¼ˆç±» | æ¨¡æ¿ï¼‰
Containers:å®¹å™¨ï¼ˆå¯¹è±¡ï¼‰
Volumesï¼šäº§ç”Ÿçš„æ•°æ®é›†åˆç”Ÿæˆçš„æ•°æ®å·ï¼ˆæ•°æ®ï¼‰


ä¸€ä¸ªimagesèƒ½äº§ç”Ÿä¸€å †çš„containerï¼Œå³ä½¿æŠŠcontaineråˆ æ‰ï¼Œimageä¹Ÿèƒ½æºæºä¸æ–­çš„ç”Ÿæˆcontainer

# 2.åŸºç¡€å‘½ä»¤
docker ps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
docker images æŸ¥çœ‹é•œåƒåˆ—è¡¨
docker rm container-id åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
docker stop/start container-id åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
docker rmi image-id åˆ é™¤æŒ‡å®š id çš„é•œåƒ
docker volume ls æŸ¥çœ‹ volume åˆ—è¡¨
docker network ls æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨

docker pullæ˜¯ä¸€ç§å‘½ä»¤ï¼Œç”¨äºä»é•œåƒä»“åº“ä¸­æ‹‰å–æˆ–è€…æ›´æ–°æŒ‡å®šé•œåƒ

ä»Docker Hubä¸‹è½½javaæœ€æ–°ç‰ˆé•œåƒ
docker pull java

# 3.å®‰è£…
æ¡Œé¢ç‰ˆï¼šhttps://www.docker.com/products/docker-desktop
æœåŠ¡å™¨ç‰ˆï¼šhttps://docs.docker.com/engine/install/#server

é•œåƒ
Docker ä¸­å›½å®˜æ–¹é•œåƒ	https://registry.docker-cn.com
DaoCloud é•œåƒç«™	http://f1361db2.m.daocloud.io
Azure ä¸­å›½é•œåƒ	https://dockerhub.azk8s.cn
ç§‘å¤§é•œåƒç«™	https://docker.mirrors.ustc.edu.cn
é˜¿é‡Œäº‘	https://<your_code>.mirror.aliyuncs.com
ä¸ƒç‰›äº‘	https://reg-mirror.qiniu.com
ç½‘æ˜“äº‘	https://hub-mirror.c.163.com
è…¾è®¯äº‘	https://mirror.ccs.tencentyun.com

```









### 12.1.2 å®‰è£…è½¯ä»¶

#### 12.1.2.1 imageä»“åº“æŸ¥æ‰¾

```shell
https://hub.docker.com/
```



#### 12.1.2.2 æ‰§è¡Œå‘½ä»¤

```shell
docker run -d -p 6379:6379 --name redis redis:latest

# -d çš„æ„æ€æ˜¯åœ¨ åå°è¿è¡Œ
#  -p 6379:6379 æŠŠdockerçš„6379æš´éœ²åˆ°å®¿ä¸»æœºçš„6379
# --name redis   å®¹å™¨å‘½åä¸ºredis

```



### 12.1.3 åˆ¶ä½œè‡ªå·±çš„image





#### 12.1.3.1 ç¼–å†™dockerfile









#### 12.1.3.2 















### 12.1.4 è™šæ‹Ÿæœºæµ‹è¯•



#### 12.1.4.1 vmware | visual box

åœ¨å‡†å¤‡å¥½ä¸‹é¢çš„ iso å’Œé•œåƒåï¼Œå¯ä»¥è¿™æ ·å­åŠ è½½ç»iæƒ³

https://blog.csdn.net/meditator_hkx/article/details/50082475



#### 12.1.4.2  æ§åˆ¶é¢æ¿ 

windowç¨‹åºä¸åŠŸèƒ½ ä¸­

- hyper-v
- è™šæ‹Ÿæœºå¹³å°
- è™šæ‹Ÿæœºç›‘æ§ç¨‹åº

è¿™å‡ ä¸ªæ‰“å¼€

#### 12.1.4.3 centos 7

ä¸‹è½½ å»åˆ°å‡ ä¸ªé•œåƒç«™ä¸‹è½½ iso å°±å¯ä»¥äº†(æ³¨æ„ä¸‹è½½miniçš„)







#### 12.1.4.4 è”ç½‘

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ è™šæ‹Ÿæœºæ˜¯æ²¡æœ‰ç½‘ç»œçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€

- æ§åˆ¶é¢æ¿-ã€‹ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ-ã€‹æ›´æ”¹é€‚é…å™¨é€‰é¡¹

- æ‰¾åˆ° ä½ çš„ è™šæ‹Ÿæœºï¼ŒåŒå‡»ç‚¹å¼€=ã€‹ç‚¹å‡»å±æ€§=ã€‹ç‚¹å‡»internet åè®®ç‰ˆæœ¬4=ã€‹ç‚¹å‡»ä½¿ç”¨ä¸‹é¢çš„ dns æœåŠ¡å™¨åœ°å€

- é¦–é€‰ æ”¹æˆ 8 8 8 8 å¤‡ç”¨æ”¹æˆ 8 8 4 4
- è®°ä½ip éœ€è¦åœ¨ 1-255ä¹‹é—´  åˆå§‹ipå¯ä»¥æ‰“å¼€ipconfig æ¥çœ‹,ç„¶åå¡«å…¥ gateway ä¹‹ç±»çš„ xx.2å°±æ˜¯äº†
- å­ç½‘æ©ç ï¼š255.255.255.0

cd /etc/sysconfig/network-scripts   root

vi ifcfg-ens33

```
ç‚¹å‡» i
```



- BOOTPROTO æ”¹æˆ static
- ONBOOTæ”¹æˆ yes

```
ç„¶åæ–°å¢ä¸‹é¢çš„
```



- IPADDR æ”¹æˆ 192.168.80.133
- GATEWAY æˆ‘è¿™é‡Œå¯ä»¥ä¸å¡«
- NETMASK æ”¹æˆ 255.255.255.0
- DNS1 å’Œ DNS 2 æ”¹æˆ 8.8.8.8 å’Œ 8.8.4.4

```
ESC + :wq
```



æœ€å service network restart 

systemctl restart network

```
ping baidu.com
```



#### 12.1.4.5 ç³»ç»Ÿåˆå§‹åŒ–

å…³é—­selinux

- æŸ¥çœ‹çŠ¶æ€ getenforce
- ä¸´æ—¶å…³é—­ setenforce 0
- vi /etc/selinux/config

```
è¾“å…¥ i è¿›å…¥ ç¼–è¾‘æ¨¡å¼ ç„¶å
æŠŠ SELINUX = disabled
```



é˜²ç«å¢™çŠ¶æ€

- æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld
- å…³é—­é˜²ç«å¢™ systemctl stop firewalld
- å…³é—­å¼€æœºå¯åŠ¨ é˜²ç«å¢™   systemctl disable firewalld



å®‰è£…ç½‘ç»œå·¥å…·

- yum install -y net-tools | è¿™æ ·å°±å¯ä»¥è¿è¡Œipconfig || å¾—åˆ° ip 10.0.2.15

vm ware å¯ä»¥æ‰§è¡Œä¸‹ä¸€æ­¥è¿›è¡Œ ssh é‡Œè¿æ¥

- yum install openssh-server -y

```shell
systemctl start sshd.service
systemctl enable sshd.service
```



ç”¨window è¿æ¥ linux

```shell
ssh root@192.168.80.133

```





#### 12.1.4.6  centoså¸¸ç”¨å·¥å…·åŒ…

```
yum install -y bash-completion vim wget net-tools nc tree dos2unix unzip telnet nethogs bc opendap-devel

curl -o /etc/yum.repos.d/centos-7.repo http: //mirrors.aliyun.com/repo/centos-7.repo
cur1 -o /etc/yum.repos.d/docker-ce.repo http: //mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum clean a11 && yum makecache
```



#### 12.1.4.7 å®‰è£… docker

```shell
yum install docker
docker --version   # Docker version 1.13.1, build 7d71120/1.13.1
systemctl start docker



```



#### 12.1.4.8 å®‰è£… docker-compose

```shell
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# ç»™docker compose ç›®å½•æˆæƒ
sudo chmod +x /usr/local/bin/docker-compose

# æŸ¥çœ‹ä¸€ä¸‹versionï¼Œæ˜¾ç¤ºæœ‰ç‰ˆæœ¬å·é‚£å°±è¯´æ˜å®‰è£…æˆåŠŸäº†
docker-compose version

q:ERROR: Couldn't connect to Docker daemon at http+docker://localunixsocket - is it running?
s: systemctl start docker | sudo docker-compose up
```







#### 12.1.4.9 Dockerfile(æ„å»ºnginxåŸºç¡€ç¤ºä¾‹)

Dockerfile æ˜¯ä¸€ä¸ªæ–‡ä»¶,ç”¨æ¥æ„å»ºimage

```yaml
FROM nginx


RUN rm -rf /usr/share/nginx/html
RUN rm /etc/nginx/nginx.conf

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºåçš„æ–‡ä»¶åˆ°Nginxé•œåƒçš„HTMLç›®å½•
COPY html /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf 
# COPY nginx.conf etc/nginx/conf.d/default.conf
RUN echo "nginx å¼€å§‹æ„å»º"

# æš´éœ²ç«¯å£81ä¾›å¤–éƒ¨è®¿é—®
EXPOSE 81

# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
    

```

è¿™ä¸€æ­¥èµ°å®Œå å¯ä»¥è¿è¡Œ

```shell
docker build  --platform linux/amd64 -t ä½ çš„ç”¨æˆ·å/ä½ çš„é•œåƒæˆ–è€…æ˜¯ä»“åº“åå­—:ç‰ˆæœ¬å·  . 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æŸ¥çœ‹åˆšåˆšç”Ÿæˆçš„ images
docker images 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æ¨é€åˆ°è¿œç«¯å» 
docker push $docker_hub_username/$docker_image_name:$docker_image_version

```

















#### 12.1.4.10 nginx.conf ç¼–å†™



```shell
worker_processes 1;


events {
	worker_connections 768;
}

http {
    # çŸ¥è¯†ç‚¹6:å¼€å¯gzip
    gzip on;
    # å¯ç”¨gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶ï¼›å°äºè®¾ç½®å€¼çš„æ–‡ä»¶å°†ä¸ä¼šè¢«å‹ç¼©
    gzip_min_length 1k;
    # gzip å‹ç¼©çº§åˆ« 1-9 
    gzip_comp_level 9;
    # è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
    # æ˜¯å¦åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encodingï¼Œå»ºè®®å¼€å¯
    gzip_vary on;



	include /etc/nginx/mime.types;
	default_type application/octet-stream;
	sendfile	on;
	keepalive_timeout	65;
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;
    upstream myserver { 
        # è½®è¯¢æ–¹å¼ | ip_hashï¼šä»¥å®¢æˆ·ç«¯IPåœ°å€ä¸ºä¾æ®ï¼ŒåŒ¹é…æœåŠ¡å™¨ã€‚ | least_connï¼šä»¥æœåŠ¡å™¨è¿æ¥æ•°ä¸ºä¾æ®ï¼Œå“ªä¸ªæœåŠ¡å™¨è¿æ¥æ•°å°‘ï¼ŒåŒ¹é…å“ªå°æœåŠ¡å™¨ã€‚
        # ip_hash; 
        # 10ç§’å†…å¦‚æœå¤±è´¥æ¬¡æ•°è¾¾åˆ°2æ¬¡ï¼Œä¼šåœç”¨10ç§’ server å‰é¢ä¸ç”¨åŠ https
        server 192.168.1.123:8088 max_fails=2  fail_timeout=10s;
        # åœç”¨
        # server localhost:8080 weight=10 down;     
        # é•¿è¿æ¥æ•°é‡
        # keepalive 50;
    }
    server {
        listen     80;
        server_name localhost;
        # çŸ¥è¯†ç‚¹1ï¼šé˜²ç›—é“¾
        location /images {
            valid_referers  192.168.80.133 localhost example.*;
            if ($invalid_referer){
                return 403;
            }
            alias /usr/share/nginx/html;
            try_files $uri $uri/ =404;
            # add_header Cache-Control no-cache;
            # add_header Cache-Control private;
        }
        # çŸ¥è¯†ç‚¹2ï¼šåå‘ä»£ç†
        location /api {
            
            proxy_pass http://192.168.1.123:8088;
            add_header 'Access-Control-Allow-Origin' é—¹ç€ç©;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }

        # çŸ¥è¯†ç‚¹3ï¼šå‰ç«¯æ–‡ä»¶
		location / {
			root /usr/share/nginx/html;
			try_files $uri/ /index.html last;
			index index.html index.htm;
		}

        # çŸ¥è¯†ç‚¹4:cdnæ­£å‘ä»£ç†
        

        location /api_proxy {
            
            proxy_pass http://myserver;
            add_header 'Access-Control-Allow-Origin' *;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }
        # çŸ¥è¯†ç‚¹5ï¼šserver ç«¯å£ç¼“å­˜
        # proxy_cache_path  /data/nuget-cache levels=1:2 keys_zone=nuget-cache:20m max_size=50g inactive=168h;
	}
	

}
```





#### 12.1.4.11 ç¼–å†™ html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
    <title>Document</title>
</head>
<style>
    *{
        text-decoration: none;
        
    }
    body{
        background-color: #ebecf0;
        display: flex;
        /* flex-direction: column; */
        width: 100%;
        overflow-x: hidden;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }
    div{
        margin: 30px;
        width: 250px;
        height: 100px;
        background: linear-gradient(145deg, #caced5, #f0f5fe);
box-shadow: 6px 6px 12px #bec3c9, -6px -6px 12px #fff;
        text-align: center;
        align-items: center;
        line-height: 100px;
    }
</style>
<body>
  <image src="./OIP-A.jpg"/>
  	<image src="/images/OIP-C.jpg"/>
    <div><a href="./project and frame/è®¾è®¡ç¨¿ä»£ç /index.html">è®¾è®¡ç¨¿ä»£ç </a></div>
    <div> <a href="./å¡ç‰‡/index.html">å¡ç‰‡</a></div>
    <!-- <div><a href="./3/index.html">3</a></div> -->
    <div><a href="./project and frame/ç™»é™†/index.html">ç™»é™†</a></div>
    <div> <a href="./404æ ·å¼/index.html">404æ ·å¼</a></div>
    <div> <a href="./åº•è¾¹æ /index.html">åº•è¾¹æ </a></div>
    <div> <a href="./project and frame/webrtc/index.html">webrtc</a></div>
    
    <div>ç­‰ç­‰ç­‰ç­‰..ä»¥åæŒç»­æ›´æ–°</div>
 
    <script>


async function ajax(options) {
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        const method = options.method.toUpperCase();
        xhr.onreadystatechange = () => {
            // xhr.readyState == 4 è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª
            if (xhr.readyState !== 4 || xhr.status === 0)
                return;
            const responseData = JSON.parse(xhr.response);
            // å½“ readyState ç­‰äº 4 ä¸”statusä¸º 200 æ—¶ï¼Œè¡¨ç¤ºå“åº”å·²å°±ç»ªï¼š
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(responseData);
            }
            else {
                reject(`request failed with status code ${xhr.status}`);
            }
        };
        if (method === 'GET') {
            let str = "?";
            let param = options.data;
            for (let i in param) {
                str += (str == "?") ? `${i}=${param[i]}` : `&${i}=${param[i]}`;
            }
            xhr.open(method, options.url + str, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	xhr.setRequestHeader('Cache-Control', 'max-age=0.1');
            xhr.send(options.data);
        }
        if (method === 'POST') {
            xhr.open(method, options.url, true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify(options.data));
        }
    });
}
let option = {
    method: "GET",
    url: "/api/GET",
    data: {
        id: "d2ddd"
    }
};
ajax(option).then((e) => {
    console.log(e);
document.querySelector("img").src=e.data
document.querySelector("img").setAttribute("test",Math.random())
});
	</script>

  
</body>
</html>
```





#### 12.1.4.12 å…å¯†ç ç™»å½• æœåŠ¡å™¨



- æœåŠ¡å™¨ï¼šssh-keygen -t rsa 

- æœ¬åœ°ï¼šssh-copy-id  -p 222 root@10.21.2.47
  ssh root@10.21.2.47 -p 222

- æœåŠ¡å™¨ï¼šchmod 700 /home/root

  chmod 700 ~/.ssh/

  chmod 600 ~/.ssh/authorized_keys









#### 12.1.4.13 shell å¯åŠ¨

```shell
#!/bin/bash

# æœ‰é”™è¯¯ç›´æ¥é€€å‡º
set -e
# step1ï¼šåˆå§‹åŒ–å˜é‡
start_time=$(date +%s) # è®°å½•è„šæœ¬å¼€å§‹æ—¶é—´
docker_image_version=${1:-1.1} # Dockeré•œåƒç‰ˆæœ¬
docker_image_name=${2:-bimddp_image} # Docker ä»“åº“ image åå­—
docker_hub_username=${3:-electroluxcode} # Docker Hub ç”¨æˆ·å
container_name=${4:-bimddp_container} # å®¹å™¨åå­—
container_expose_port=${5:-81} # å®¹å™¨æš´éœ²çš„ç«¯å£

server_username=${6:-root} # LinuxæœåŠ¡å™¨ç”¨æˆ·å
server_address=${7:-192.168.80.133} # LinuxæœåŠ¡å™¨åœ°å€



# step2ï¼šæ²¡ç™»é™†é¦–å…ˆç™»å½•ä¸€ä¸‹
# docker login -u 3451613934@qq.com -p 
# yarn build

# step3ï¼š æ³¨æ„è¿™ä¸ª image åº”è¯¥è¦æå‰æ„å»º
# -t æŒ‡å®šæ„å»ºé•œåƒçš„åå­—å’Œç‰ˆæœ¬  -f è¿™ä¸ªå¥½åƒæ˜¯é”™çš„
echo -e "\e[91m --æœ¬åœ°buildä¸­--"
docker build  --platform linux/amd64 -t $docker_hub_username/$docker_image_name:$docker_image_version  . 
docker push $docker_hub_username/$docker_image_name:$docker_image_version
echo -e "\e[0m"

# 34---a48042d416af


# step4:è¿™ä¸€æ­¥å¯ä»¥ ssh-copy-id å»é™¤ç™»å½•  
# åŠ ä¸ŠåŒå¼•å·æ˜¯åœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œå‘½ä»¤,ä¸ç„¶å°±æ˜¯åœ¨æœ¬æœºæ‰§è¡Œå‘½ä»¤
echo -e "\e[92m --æœåŠ¡å™¨éƒ¨ç½²ä¸­--"
ssh -t $server_username@$server_address << EOF

docker ps
docker stop $container_name
docker rm $container_name

echo è¦åˆ é™¤çš„é•œåƒid:"\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
if [ -n "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)" ]; then
  docker rmi "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
  echo "åˆ é™¤æ—§é•œåƒæˆåŠŸ"
fi


docker pull $docker_hub_username/$docker_image_name:$docker_image_version
if [ $? -ne 0 ]; then
  echo "Dockeré•œåƒæ‹‰å–å¤±è´¥,è„šæœ¬è¢«ç»ˆæ­¢."
  exit 1
fi

docker run -d --name $container_name -p $container_expose_port:80 $docker_hub_username/$docker_image_name:$docker_image_version
docker ps
exit

EOF


echo -e "\e[0m"

# docker images |  docker rmi  id id | docker rmi $(docker images -q)
# è®¡ç®—æ•´ä¸ªè„šæœ¬çš„ç”¨æ—¶
end_time=$(date +%s)
duration=$((end_time - start_time))
formatted_duration=$(date -u -d @"$duration" +"%H:%M:%S")

echo "âœ¨ğŸ‰ğŸˆæ­å–œæ‚¨, éƒ¨ç½²æˆåŠŸ!"
echo "æ•´ä¸ªè¿‡ç¨‹èŠ±è´¹ $formatted_duration"
```











æ³¨æ„å¾ˆå¯èƒ½å› ä¸ºç½‘ç»œåŸå› éƒ¨ç½²å¤±è´¥

ç«¯å£å·ä¸€è‡´

```sh
æ³¨æ„nginx.conf å’Œ å®¹å™¨çš„ç«¯å£å·ä¿æŒä¸€è‡´
ç„¶ådockerfile export çš„ ç«¯å£å· å’ŒæœåŠ¡å™¨ å¼€æ”¾çš„ç«¯å£å·ä¿æŒä¸€è‡´
```



ç®€å•çš„è°ƒè¯•å‘½ä»¤å¦‚ä¸‹

```sh
# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
```



## 12.2 nginx



### 12.2.1 åŸºç¡€å‘½ä»¤ | ä¸‹è½½

```ts
--0.ä¸‹è½½
http://nginx.org/en/download.html
è§£å‹ä¹‹åç›´æ¥æŒ‰ä¸‹é¢

æŸ¥çœ‹nginx å®‰è£…ç›®å½•. 
ps -ef | grep nginx. 
äºŒã€æŸ¥çœ‹é…ç½®æ–‡ä»¶nginx.conf è·¯å¾„. 
nginx -t.
--1.
nginx  //å¯åŠ¨
nginx -s stop //å…³é—­
nginx -v //ç‰ˆæœ¬æŸ¥çœ‹
nginx -s reload //é‡æ–°é…ç½®


--2. 
fastCGI : å¿«é€Ÿå…¬å…±ç½‘å…³æ¥å£åè®®;


æ³¨æ„åœ¨htmlä¸‹é¢æ–°å»º æ–‡ä»¶å¤¹
location /test/ {
    root   html;
    index index1.html index.htm;
    try_files $uri $uri/ /index.html;
    proxy_pass https://nginx_boot/;
}
```





### 12.2.2 è½¬å‘ç«¯å£

#### 12.2.2.1 hostsæ–‡ä»¶ä¸­

C:\Windows\System32\drivers\etc\hosts æ·»åŠ 

```
127.0.0.1       a.b.com
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—® http://a.b.com

æ³¨æ„è¿™é‡Œçš„host åé¢ä¸èƒ½å¤ŸåŠ ç«¯å£ï¼Œä¸ç„¶è®¿é—®å¤±æ•ˆã€‚

æ³¨æ„å¦‚æœä½ å¯åŠ¨çš„æœåŠ¡æœ‰ ssl ä¹Ÿå°±æ˜¯ https æœåŠ¡ ã€‚ é‚£ä¹ˆå¯ä»¥åœ¨å‰ç¼€å¤´åŠ ä¸Šså˜æˆhttps://a.b.com





#### 12.2.2.2 nginx.conf

```shell
#gzip  on;
    server {
    	# è‡ªå·±çš„åœ°å€
        listen       8280;
        server_name  a.b.com;
        # error_page   405 =200 @405;
        location /api {
            add_header 'Access-Control-Allow-Origin' *;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            add_header 'Access-Control-Allow-Headers' *;
            # error_page 405 =200 http://$host$request_uri;
            #åç«¯ çš„ åœ°å€
            proxy_pass http://localhost:8088;
            proxy_redirect off;
            proxy_set_header Host $host;
			proxy_set_header X-Forwarded-Proto $scheme;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header Upgrade $http_upgrade; 
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_connect_timeout 18000;
			proxy_send_timeout 18000;
			proxy_read_timeout 18000;
            # index  index.html index.htm index.jsp;
            
        }

    }
```



#### 12.2.2.3 å¯åŠ¨ | é‡å¯ nginx è„šæœ¬

```shell
# reload.bat
nginx -s reload

# start.bat
@echo off
rem å¦‚æœå¯åŠ¨å‰å·²ç»å¯åŠ¨nginxå¹¶è®°å½•ä¸‹pidæ–‡ä»¶ï¼Œä¼škillæŒ‡å®šè¿›ç¨‹
nginx.exe -s stop

rem æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§
nginx.exe -t -c conf/nginx.conf

rem æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
nginx.exe -v

rem æŒ‰ç…§æŒ‡å®šé…ç½®å»å¯åŠ¨nginx
nginx.exe -c conf/nginx.conf

@REM  é‡å¯å‘½ä»¤ï¼šnginx -s reload 
@REM nginx -s quit   å¹³ç¨³å…³é—­Nginxï¼Œä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å®‰æ’çš„ç»“æŸwebæœåŠ¡

```

#### 12.2.2.4 æµ‹è¯•js

```js
 let ajax1 = (data, url) => {
     //step1 : è®¾ç½®è¯·æ±‚å¤´
     let xhr = new XMLHttpRequest();
     //step2ï¼šè®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚å¤´ //trueè¡¨ç¤ºå¼‚æ­¥
     xhr.open("POST", url, true);
     xhr.setRequestHeader("Content-type", "application/json");
     //step3ï¼šè¯·æ±‚æ•°æ®
     xhr.send();
     // step4ï¼šreadyStateæ˜¯xhrçš„è¯·æ±‚çŠ¶æ€
     //çŠ¶æ€4è¡¨ç¤ºå·²å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å·²å®Œæˆè¿”å›å“åº”ï¼Œæµè§ˆå™¨å·²å®Œæˆäº†ä¸‹è½½å“åº”å†…å®¹ã€‚0-4éƒ½æœ‰å€¼çš„
     xhr.onreadystatechange = function () {

         if (xhr.readyState === 4 && xhr.status === 200) {
             console.log(xhr.responseText);
         }
     };
 }
 let url = "/api/post"

 ajax1(url, url)
```



### 12.2.3 è™šæ‹Ÿäººç«¯å£ç¤ºä¾‹ /etc/nginx/sites-enabled/vh2d

```shell
#map $sent_http_content_type $expires {
#    default                    off;
    #text/html                  epoch; # ä¸ç¼“å­˜
#    text/css                   max; 
#    application/javascript     max;
#    ~image/                    max;  
#}
server {
    listen 80 default_server;
    server_name virtualhuman.cvte.com;
#    expires $expires;

    location /admin {
        alias /var/digitalHuman/virtualHumanAdmin/dist;
        index  index.html index.htm;
        try_files $uri $uri/ /admin/index.html;
            if ($request_filename ~* .*\.(?:htm|html)$){
        } 
        client_max_body_size    1000m;
   }
 
    location / {
        alias /var/digitalHuman/digitalHuman/dist/;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html;
        client_max_body_size    1000m;
        if ($request_filename ~* .*\.(?:htm|html)$){
        } 
    }

    location /api {
        proxy_pass http://localhost:8081;
        proxy_set_header X-forwarded-for $proxy_add_x_forwarded_for;
        proxy_set_header X-forwarded-proto https;
        proxy_set_header X-forwarded-host $host;
    }

    location /worker1 {
        proxy_pass http://localhost:8090;
    }

    location ~ ^/(resource|output)/ {
        proxy_pass http://localhost:9000;

	proxy_set_header Host $host;
    }
}


```



### 12.2.4 ä¸ªäººç«¯å£ç¤ºä¾‹

```shell
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##
        client_max_body_size 100m;
	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;

	##
	# Gzip Settings
	##

	gzip on;



	include /etc/nginx/conf.d/*.conf;
	# é‡è¦
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}

```



## 12.3 shell 







### 12.3.1 åŸºç¡€



#### string

```sh
test=5;echo $test
if [ "test" ]; then
echo "åˆ é™¤æ—§é•œåƒæˆåŠŸ"
 
fi
```





#### 12.3.1.1 å¾ªç¯

```shell
echo "è¯·è¾“å…¥ä½ æƒ³æ²Ÿé€šçš„äººæ•°"
read n
count=1
while ((count<=n))
do  
    # do something
    
    sleep 2
    echo "å½“å‰æ²Ÿé€šäº†: $count äºº"
    ((count++))
    sleep 2
done
```



#### 12.3.1.2  æ•°ç»„

```shell
# 1.æ•°ç»„å£°æ˜ åç§°=(å…ƒç´  å…ƒç´  å…ƒç´ ) =å·¦å³èµ‹å€¼çš„æ—¶å€™ä¸ç”¨åŠ ç©ºæ ¼ 

# "" å˜æˆ å˜é‡ , '' å…¨éƒ¨ä¸æ˜¯å˜é‡éƒ½æ˜¯å­—ç¬¦ä¸²
# ARRAY_NAME=("element_1st" "element_2nd" "element_3th")

# 2.æ‰“å°å…ƒç´ 
# 2.1 æ‰“å°æ‰€æœ‰ å…ƒç´ 
# echo ${ARRAY_NAME[@]}
# 2.2 æ‰“å°å•ä¸ªå…ƒç´ 
# echo ${ARRAY_NAME[0]}
# 2.3 å¾ªç¯æ‰“å°
# for i in "${ARRAY_NAME[@]}"; do 
# echo "$i"; 
# done

ARRAY_NAME=()
ARRAY_NAME+=("æ–‡ä»¶ '%s'\n" *.sh)
echo ${ARRAY_NAME[@]}


```







### 12.3.2 æŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ çš„ æ–‡ä»¶ | å†™å…¥

```shell
ARRAY_NAME=()
ARRAY_NAME+=(*.sh)


count=1
echo ${ARRAY_NAME[0]} 

for i in "${ARRAY_NAME[@]}"; do 
    # > æ˜¯ å¼ºåˆ¶è¦†å†™
    # >> æ˜¯ åœ¨å°¾éƒ¨æ·»åŠ 
    #  $(date +%Y%m%d%H%M%S) å¯¹åº”ç€å¹´ æœˆ æ—¥ æ—¶åˆ†ç§’
    echo "$i $(date +%Y%m%d%H%M%S) $count " >> output.txt; 
    ((count++))
done
```











### 12.3.3 æŸ¥æ‰¾æ–‡ä»¶

```shell
find /xx "xx.conf"
```





### 12.3.4 æŸ¥æ‰¾æ·±åº¦æ–‡ä»¶åˆ°å½“å‰çš„æ–‡ä»¶å¤¹ä¸‹é¢

```js
find . -name "*.js"   -exec mv '{}' ./ \;
```



### 12.3.5 ç§»åŠ¨ å¤åˆ¶ åˆ é™¤ é‡æ–°å‘½å

```shell
echo "hello world"
# 1.åˆ›é€ 
touch æ–‡ä»¶
mkdir ç›®å½•å
sleep 3
# ç§»åŠ¨æ–‡ä»¶

# 2. å‘½å å’Œ ç§»åŠ¨ æ–‡ä»¶ mv æ–‡ä»¶  D:/cicd-test/ç›®å½•å
# é‡æ–°å‘½å
mv æ–‡ä»¶ é‡æ–°å‘½åæ–‡ä»¶
mv  ç›®å½•å/ é‡æ–°å‘½åç›®å½•å/
sleep 3
echo "6s after"
# rm æ–‡ä»¶
# rmdir ç›®å½•å



```







### 12.3.6 CICD ç¤ºä¾‹

```shell


â€‹```SH
# window çš„æ‰©å±• ï¼š https://www.azimiao.com/8040.html

# step1 ï¼š https://sourceforge.net/projects/gnuwin32/files/zip/3.0/ 
# step2 ï¼š æ‰¾åˆ° Git æ–‡ä»¶å¤¹ä¸‹çš„usr/binç›®å½•ï¼Œå°†è§£å‹åbiné‡Œé¢çš„ä¸œè¥¿å¤åˆ¶è¿›å»

# æå‰ ssh é…ç½® ä¸€ä¸‹

# ssh root@10.21.2.47 -p 222

# ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ è¾“å‡ºï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥
node test.js
zip  ./dist.zip ./build -r

scp  -P 222 -r dist.zip root@10.21.2.47:/root/project  # ä¸Šä¼ ç›®å½•
ssh root@10.21.2.47 -p 222 < easyUnzip.sh
â€‹```



easyUnzip.sh

â€‹```SH
# è§£å‹è¿›è¡Œè¦†ç›–
unzip -o /root/project/dist.zip -d /root/project/
â€‹```


```

