# 12.è¿ç»´

[[toc]]



```shell
https://mirrors.tuna.tsinghua.edu.cn/ubuntu/
```



## 12.1 docker

æ–‡æ¡£ï¼šhttps://docs.docker.com/engine/reference/commandline/run/

ä»“åº“ï¼šhttps://hub.docker.com/

### 12.1.1 åŸºç¡€

```shell
# 1. åŸºç¡€ç±»åˆ«
Imagesï¼šæ‰“åŒ…çš„é•œåƒï¼ˆç±» | æ¨¡æ¿ï¼‰
Containers:å®¹å™¨ï¼ˆå¯¹è±¡ï¼‰
Volumesï¼šäº§ç”Ÿçš„æ•°æ®é›†åˆç”Ÿæˆçš„æ•°æ®å·ï¼ˆæ•°æ®ï¼‰


ä¸€ä¸ªimagesèƒ½äº§ç”Ÿä¸€å †çš„containerï¼Œå³ä½¿æŠŠcontaineråˆ æ‰ï¼Œimageä¹Ÿèƒ½æºæºä¸æ–­çš„ç”Ÿæˆcontainer

# 2.åŸºç¡€å‘½ä»¤
docker ps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
docker images æŸ¥çœ‹é•œåƒåˆ—è¡¨
docker rm container-id åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
docker stop/start container-id åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
docker rmi image-id åˆ é™¤æŒ‡å®š id çš„é•œåƒ
docker volume ls æŸ¥çœ‹ volume åˆ—è¡¨
docker network ls æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨

docker pullæ˜¯ä¸€ç§å‘½ä»¤ï¼Œç”¨äºä»é•œåƒä»“åº“ä¸­æ‹‰å–æˆ–è€…æ›´æ–°æŒ‡å®šé•œåƒ

ä»Docker Hubä¸‹è½½javaæœ€æ–°ç‰ˆé•œåƒ
docker pull java

# 3.å®‰è£…
æ¡Œé¢ç‰ˆï¼šhttps://www.docker.com/products/docker-desktop
æœåŠ¡å™¨ç‰ˆï¼šhttps://docs.docker.com/engine/install/#server

é•œåƒ
Docker ä¸­å›½å®˜æ–¹é•œåƒ	https://registry.docker-cn.com
DaoCloud é•œåƒç«™	http://f1361db2.m.daocloud.io
Azure ä¸­å›½é•œåƒ	https://dockerhub.azk8s.cn
ç§‘å¤§é•œåƒç«™	https://docker.mirrors.ustc.edu.cn
é˜¿é‡Œäº‘	https://<your_code>.mirror.aliyuncs.com
ä¸ƒç‰›äº‘	https://reg-mirror.qiniu.com
ç½‘æ˜“äº‘	https://hub-mirror.c.163.com
è…¾è®¯äº‘	https://mirror.ccs.tencentyun.com

```









### 12.1.2 å®‰è£…è½¯ä»¶

#### 12.1.2.1 imageä»“åº“æŸ¥æ‰¾

```shell
https://hub.docker.com/
```



#### 12.1.2.2 æ‰§è¡Œå‘½ä»¤

```shell
docker run -d -p 6379:6379 --name redis redis:latest

# -d çš„æ„æ€æ˜¯åœ¨ åå°è¿è¡Œ
#  -p 6379:6379 æŠŠdockerçš„6379æš´éœ²åˆ°å®¿ä¸»æœºçš„6379
# --name redis   å®¹å™¨å‘½åä¸ºredis

```



### 12.1.3 åˆ¶ä½œè‡ªå·±çš„image





#### 12.1.3.1 ç¼–å†™dockerfile









#### 12.1.3.2 















### 12.1.4 è™šæ‹Ÿæœºæµ‹è¯•



#### 12.1.4.1 vmware | visual box

åœ¨å‡†å¤‡å¥½ä¸‹é¢çš„ iso å’Œé•œåƒåï¼Œå¯ä»¥è¿™æ ·å­åŠ è½½

https://blog.csdn.net/meditator_hkx/article/details/50082475



#### 12.1.4.2  æ§åˆ¶é¢æ¿ 

windowç¨‹åºä¸åŠŸèƒ½ ä¸­

- hyper-v
- è™šæ‹Ÿæœºå¹³å°
- è™šæ‹Ÿæœºç›‘æ§ç¨‹åº

è¿™å‡ ä¸ªæ‰“å¼€

#### 12.1.4.3 centos 7

ä¸‹è½½ å»åˆ°å‡ ä¸ªé•œåƒç«™ä¸‹è½½ iso å°±å¯ä»¥äº†(æ³¨æ„ä¸‹è½½miniçš„)

```ts
é“¾æ¥ï¼šhttps://pan.baidu.com/s/1Tthc8umiqGiyvFsv2ts7fQ?pwd=y064 
æå–ç ï¼šy064 
--æ¥è‡ªç™¾åº¦ç½‘ç›˜è¶…çº§ä¼šå‘˜V6çš„åˆ†äº«
```







#### 12.1.4.4 è”ç½‘

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ è™šæ‹Ÿæœºæ˜¯æ²¡æœ‰ç½‘ç»œçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€

è¿™ä¸ªæ˜¯ç½‘ä¸Šçš„æ•™ç¨‹ï¼Œæˆ‘è¿™é‡Œå¥½åƒä¸é€‚ç”¨

```ts


- æ§åˆ¶é¢æ¿-ã€‹ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ-ã€‹æ›´æ”¹é€‚é…å™¨é€‰é¡¹
- æ‰¾åˆ° ä½ çš„ è™šæ‹Ÿæœºï¼ŒåŒå‡»ç‚¹å¼€=ã€‹ç‚¹å‡»å±æ€§=ã€‹ç‚¹å‡»internet åè®®ç‰ˆæœ¬4=ã€‹ç‚¹å‡»ä½¿ç”¨ä¸‹é¢çš„ dns æœåŠ¡å™¨åœ°å€
  - é¦–é€‰DNS æ”¹æˆ 8 8 8 8 å¤‡ç”¨DNSæ”¹æˆ 8 8 4 4
  - gateway ä¹‹ç±»çš„ xx.2å°±æ˜¯äº†
  - å­ç½‘æ©ç ï¼š255.255.255.0
  - è®°ä½ip éœ€è¦åœ¨ 1-255ä¹‹é—´  åˆå§‹ipå¯ä»¥æ‰“å¼€ipconfig æ¥çœ‹,ç„¶åå¡«å…¥

    

  
```



cd /etc/sysconfig/network-scripts   root

vi ifcfg-ens33

```
ç‚¹å‡» i
```



- BOOTPROTO æ”¹æˆ static
- ONBOOTæ”¹æˆ yes

- IPADDR æ”¹æˆ xxx.133   `è¿™é‡Œçš„ä½œç”¨æ˜¯ssh`  192.168.80.123
- GATEWAY æˆ‘è¿™é‡Œå¯ä»¥ä¸å¡«
- NETMASK æ”¹æˆ 255.255.255.0
- DNS1 å’Œ DNS 2 æ”¹æˆ 8.8.8.8 å’Œ 8.8.4.4

```
ESC + :wq
```



æœ€å service network restart 

systemctl restart network

```
ping baidu.com
```



#### 12.1.4.5 ç³»ç»Ÿåˆå§‹åŒ–

å…³é—­selinux

- æŸ¥çœ‹çŠ¶æ€ getenforce
- ä¸´æ—¶å…³é—­ setenforce 0
- vi /etc/selinux/config

```
è¾“å…¥ i è¿›å…¥ ç¼–è¾‘æ¨¡å¼ ç„¶å
æŠŠ SELINUX = disabled
```



é˜²ç«å¢™çŠ¶æ€

- æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ systemctl status firewalld
- å…³é—­é˜²ç«å¢™ systemctl stop firewalld
- å…³é—­å¼€æœºå¯åŠ¨ é˜²ç«å¢™   systemctl disable firewalld



å®‰è£…ç½‘ç»œå·¥å…·

- yum install -y net-tools | è¿™æ ·å°±å¯ä»¥è¿è¡Œipconfig || å¾—åˆ° ip 10.0.2.15

vm ware å¯ä»¥æ‰§è¡Œä¸‹ä¸€æ­¥è¿›è¡Œ ssh é‡Œè¿æ¥

- yum install openssh-server -y

```shell
systemctl start sshd.service
systemctl enable sshd.service
```



ç”¨window è¿æ¥ linux

```shell
ssh root@192.168.80.133

```





#### 12.1.4.6  centoså¸¸ç”¨å·¥å…·åŒ…

```
yum install -y bash-completion vim wget net-tools nc tree dos2unix unzip telnet nethogs bc opendap-devel

curl -o /etc/yum.repos.d/centos-7.repo http: //mirrors.aliyun.com/repo/centos-7.repo
cur1 -o /etc/yum.repos.d/docker-ce.repo http: //mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum clean a11 && yum makecache
```



#### 12.1.4.7 å®‰è£… docker

```shell
yum install docker
docker --version   # Docker version 1.13.1, build 7d71120/1.13.1
systemctl start docker

# å¯åŠ¨ docker ï¼šservice docker start
# docker run -d --name $container_name -p å¯¹å¤–é¢æš´éœ²çš„ç«¯å£:80 $docker_hub_username/$docker_image_name:$docker_image_version
# # docker run -d --name bimddp_image -p 81:80 electroluxcode/bimddp_image:1.1


```



#### 12.1.4.8 å®‰è£… docker-compose

```shell
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# ç»™docker compose ç›®å½•æˆæƒ
sudo chmod +x /usr/local/bin/docker-compose

# æŸ¥çœ‹ä¸€ä¸‹versionï¼Œæ˜¾ç¤ºæœ‰ç‰ˆæœ¬å·é‚£å°±è¯´æ˜å®‰è£…æˆåŠŸäº†
docker-compose version

q:ERROR: Couldn't connect to Docker daemon at http+docker://localunixsocket - is it running?
s: systemctl start docker | sudo docker-compose up
```







#### 12.1.4.9 Dockerfile(æ„å»ºnginxåŸºç¡€ç¤ºä¾‹)

Dockerfile æ˜¯ä¸€ä¸ªæ–‡ä»¶,ç”¨æ¥æ„å»ºimage

```yaml
FROM nginx


RUN rm -rf /usr/share/nginx/html
RUN rm /etc/nginx/nginx.conf

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºåçš„æ–‡ä»¶åˆ°Nginxé•œåƒçš„HTMLç›®å½•
COPY html /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf 
# COPY nginx.conf etc/nginx/conf.d/default.conf
RUN echo "nginx å¼€å§‹æ„å»º"

# æš´éœ²ç«¯å£81ä¾›å¤–éƒ¨è®¿é—®
EXPOSE 81

# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
    

```

è¿™ä¸€æ­¥èµ°å®Œå å¯ä»¥è¿è¡Œ

```shell
docker build  --platform linux/amd64 -t ä½ çš„ç”¨æˆ·å/ä½ çš„é•œåƒæˆ–è€…æ˜¯ä»“åº“åå­—:ç‰ˆæœ¬å·  . 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æŸ¥çœ‹åˆšåˆšç”Ÿæˆçš„ images
docker images 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æ¨é€åˆ°è¿œç«¯å» 
docker push $docker_hub_username/$docker_image_name:$docker_image_version

```

















#### 12.1.4.10 nginx.conf ç¼–å†™



```shell
worker_processes 1;


events {
	worker_connections 768;
}

http {
    # çŸ¥è¯†ç‚¹6:å¼€å¯gzip
    gzip on;
    # å¯ç”¨gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶ï¼›å°äºè®¾ç½®å€¼çš„æ–‡ä»¶å°†ä¸ä¼šè¢«å‹ç¼©
    gzip_min_length 1k;
    # gzip å‹ç¼©çº§åˆ« 1-9 
    gzip_comp_level 9;
    # è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
    # æ˜¯å¦åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encodingï¼Œå»ºè®®å¼€å¯
    gzip_vary on;



	include /etc/nginx/mime.types;
	default_type application/octet-stream;
	sendfile	on;
	keepalive_timeout	65;
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;
    upstream myserver { 
        # è½®è¯¢æ–¹å¼ | ip_hashï¼šä»¥å®¢æˆ·ç«¯IPåœ°å€ä¸ºä¾æ®ï¼ŒåŒ¹é…æœåŠ¡å™¨ã€‚ | least_connï¼šä»¥æœåŠ¡å™¨è¿æ¥æ•°ä¸ºä¾æ®ï¼Œå“ªä¸ªæœåŠ¡å™¨è¿æ¥æ•°å°‘ï¼ŒåŒ¹é…å“ªå°æœåŠ¡å™¨ã€‚
        # ip_hash; 
        # 10ç§’å†…å¦‚æœå¤±è´¥æ¬¡æ•°è¾¾åˆ°2æ¬¡ï¼Œä¼šåœç”¨10ç§’ server å‰é¢ä¸ç”¨åŠ https
        server 192.168.1.123:8088 max_fails=2  fail_timeout=10s;
        # åœç”¨
        # server localhost:8080 weight=10 down;     
        # é•¿è¿æ¥æ•°é‡
        # keepalive 50;
    }
    server {
        listen     80;
        server_name localhost;
        # çŸ¥è¯†ç‚¹1ï¼šé˜²ç›—é“¾
        location /images {
            valid_referers  192.168.80.133 localhost example.*;
            if ($invalid_referer){
                return 403;
            }
            alias /usr/share/nginx/html;
            try_files $uri $uri/ =404;
            # add_header Cache-Control no-cache;
            # add_header Cache-Control private;
        }
        # çŸ¥è¯†ç‚¹2ï¼šåå‘ä»£ç†
        location /api {
            
            proxy_pass http://192.168.1.123:8088;
            add_header 'Access-Control-Allow-Origin' é—¹ç€ç©;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }

        # çŸ¥è¯†ç‚¹3ï¼šå‰ç«¯æ–‡ä»¶
		location / {
			root /usr/share/nginx/html;
			try_files $uri/ /index.html last;
			index index.html index.htm;
		}

        # çŸ¥è¯†ç‚¹4:cdnæ­£å‘ä»£ç†
        

        location /api_proxy {
            
            proxy_pass http://myserver;
            add_header 'Access-Control-Allow-Origin' *;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }
        # çŸ¥è¯†ç‚¹5ï¼šserver ç«¯å£ç¼“å­˜
        # proxy_cache_path  /data/nuget-cache levels=1:2 keys_zone=nuget-cache:20m max_size=50g inactive=168h;
	}
	

}
```





#### 12.1.4.11 ç¼–å†™ html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
    <title>Document</title>
</head>
<style>
    *{
        text-decoration: none;
        
    }
    body{
        background-color: #ebecf0;
        display: flex;
        /* flex-direction: column; */
        width: 100%;
        overflow-x: hidden;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }
    div{
        margin: 30px;
        width: 250px;
        height: 100px;
        background: linear-gradient(145deg, #caced5, #f0f5fe);
box-shadow: 6px 6px 12px #bec3c9, -6px -6px 12px #fff;
        text-align: center;
        align-items: center;
        line-height: 100px;
    }
</style>
<body>
  <image src="./OIP-A.jpg"/>
  	<image src="/images/OIP-C.jpg"/>
    <div><a href="./project and frame/è®¾è®¡ç¨¿ä»£ç /index.html">è®¾è®¡ç¨¿ä»£ç </a></div>
    <div> <a href="./å¡ç‰‡/index.html">å¡ç‰‡</a></div>
    <!-- <div><a href="./3/index.html">3</a></div> -->
    <div><a href="./project and frame/ç™»é™†/index.html">ç™»é™†</a></div>
    <div> <a href="./404æ ·å¼/index.html">404æ ·å¼</a></div>
    <div> <a href="./åº•è¾¹æ /index.html">åº•è¾¹æ </a></div>
    <div> <a href="./project and frame/webrtc/index.html">webrtc</a></div>
    
    <div>ç­‰ç­‰ç­‰ç­‰..ä»¥åæŒç»­æ›´æ–°</div>
 
    <script>


async function ajax(options) {
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        const method = options.method.toUpperCase();
        xhr.onreadystatechange = () => {
            // xhr.readyState == 4 è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª
            if (xhr.readyState !== 4 || xhr.status === 0)
                return;
            const responseData = JSON.parse(xhr.response);
            // å½“ readyState ç­‰äº 4 ä¸”statusä¸º 200 æ—¶ï¼Œè¡¨ç¤ºå“åº”å·²å°±ç»ªï¼š
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(responseData);
            }
            else {
                reject(`request failed with status code ${xhr.status}`);
            }
        };
        if (method === 'GET') {
            let str = "?";
            let param = options.data;
            for (let i in param) {
                str += (str == "?") ? `${i}=${param[i]}` : `&${i}=${param[i]}`;
            }
            xhr.open(method, options.url + str, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	xhr.setRequestHeader('Cache-Control', 'max-age=0.1');
            xhr.send(options.data);
        }
        if (method === 'POST') {
            xhr.open(method, options.url, true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify(options.data));
        }
    });
}
let option = {
    method: "GET",
    url: "/api/GET",
    data: {
        id: "d2ddd"
    }
};
ajax(option).then((e) => {
    console.log(e);
document.querySelector("img").src=e.data
document.querySelector("img").setAttribute("test",Math.random())
});
	</script>

  
</body>
</html>
```





#### 12.1.4.12 å…å¯†ç ç™»å½• æœåŠ¡å™¨



- æœåŠ¡å™¨ï¼šssh-keygen -t rsa 

- æœ¬åœ°ï¼šssh-copy-id  -p 22 root@192.168.80.133
  ssh root@192.168.80.133 -p 22

- æœåŠ¡å™¨ï¼šchmod 700 /home/root

  chmod 700 ~/.ssh/

  chmod 600 ~/.ssh/authorized_keys









#### 12.1.4.13 shell å¯åŠ¨

```shell
#!/bin/bash

# æœ‰é”™è¯¯ç›´æ¥é€€å‡º
set -e
# step1ï¼šåˆå§‹åŒ–å˜é‡
start_time=$(date +%s) # è®°å½•è„šæœ¬å¼€å§‹æ—¶é—´
docker_image_version=${1:-1.1} # Dockeré•œåƒç‰ˆæœ¬
docker_image_name=${2:-bimddp_image} # Docker ä»“åº“ image åå­—
docker_hub_username=${3:-electroluxcode} # Docker Hub ç”¨æˆ·å
container_name=${4:-bimddp_container} # å®¹å™¨åå­—
container_expose_port=${5:-81} # å®¹å™¨æš´éœ²çš„ç«¯å£

server_username=${6:-root} # LinuxæœåŠ¡å™¨ç”¨æˆ·å
server_address=${7:-192.168.80.133} # LinuxæœåŠ¡å™¨åœ°å€



# step2ï¼šæ²¡ç™»é™†é¦–å…ˆç™»å½•ä¸€ä¸‹
# docker login -u 3451613934@qq.com -p 
# yarn build

# step3ï¼š æ³¨æ„è¿™ä¸ª image åº”è¯¥è¦æå‰æ„å»º
# -t æŒ‡å®šæ„å»ºé•œåƒçš„åå­—å’Œç‰ˆæœ¬  -f è¿™ä¸ªå¥½åƒæ˜¯é”™çš„
echo -e "\e[91m --æœ¬åœ°buildä¸­--"
docker build  --platform linux/amd64 -t $docker_hub_username/$docker_image_name:$docker_image_version  . 
docker push $docker_hub_username/$docker_image_name:$docker_image_version
echo -e "\e[0m"

# 34---a48042d416af


# step4:è¿™ä¸€æ­¥å¯ä»¥ ssh-copy-id å»é™¤ç™»å½•  
# åŠ ä¸ŠåŒå¼•å·æ˜¯åœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œå‘½ä»¤,ä¸ç„¶å°±æ˜¯åœ¨æœ¬æœºæ‰§è¡Œå‘½ä»¤
echo -e "\e[92m --æœåŠ¡å™¨éƒ¨ç½²ä¸­--"
ssh -t $server_username@$server_address << EOF

docker ps
docker stop $container_name
docker rm $container_name

echo è¦åˆ é™¤çš„é•œåƒid:"\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
if [ -n "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)" ]; then
  docker rmi "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
  echo "åˆ é™¤æ—§é•œåƒæˆåŠŸ"
fi


docker pull $docker_hub_username/$docker_image_name:$docker_image_version
if [ $? -ne 0 ]; then
  echo "Dockeré•œåƒæ‹‰å–å¤±è´¥,è„šæœ¬è¢«ç»ˆæ­¢."
  exit 1
fi

docker run -d --name $container_name -p $container_expose_port:80 $docker_hub_username/$docker_image_name:$docker_image_version
docker ps
exit

EOF


echo -e "\e[0m"

# docker images |  docker rmi  id id | docker rmi $(docker images -q)
# è®¡ç®—æ•´ä¸ªè„šæœ¬çš„ç”¨æ—¶
end_time=$(date +%s)
duration=$((end_time - start_time))
formatted_duration=$(date -u -d @"$duration" +"%H:%M:%S")

echo "âœ¨ğŸ‰ğŸˆæ­å–œæ‚¨, éƒ¨ç½²æˆåŠŸ!"
echo "æ•´ä¸ªè¿‡ç¨‹èŠ±è´¹ $formatted_duration"
```









#### 12.1.4.14

æ³¨æ„å¾ˆå¯èƒ½å› ä¸ºç½‘ç»œåŸå› éƒ¨ç½²å¤±è´¥

ç«¯å£å·ä¸€è‡´

```sh
æ³¨æ„nginx.conf å’Œ å®¹å™¨çš„ç«¯å£å·ä¿æŒä¸€è‡´
ç„¶ådockerfile export çš„ ç«¯å£å· å’ŒæœåŠ¡å™¨ å¼€æ”¾çš„ç«¯å£å·ä¿æŒä¸€è‡´
```



ç®€å•çš„è°ƒè¯•å‘½ä»¤å¦‚ä¸‹

```sh
# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
```



## 12.2 nginx



### 12.2.1 åŸºç¡€å‘½ä»¤ | ä¸‹è½½

```ts
--0.ä¸‹è½½
http://nginx.org/en/download.html
è§£å‹ä¹‹åç›´æ¥æŒ‰ä¸‹é¢

æŸ¥çœ‹nginx å®‰è£…ç›®å½•. 
ps -ef | grep nginx. 
äºŒã€æŸ¥çœ‹é…ç½®æ–‡ä»¶nginx.conf è·¯å¾„. 
nginx -t.
--1.
nginx  //å¯åŠ¨
nginx -s stop //å…³é—­
nginx -v //ç‰ˆæœ¬æŸ¥çœ‹
nginx -s reload //é‡æ–°é…ç½®


--2. 
fastCGI : å¿«é€Ÿå…¬å…±ç½‘å…³æ¥å£åè®®;


æ³¨æ„åœ¨htmlä¸‹é¢æ–°å»º æ–‡ä»¶å¤¹
location /test/ {
    root   html;
    index index1.html index.htm;
    try_files $uri $uri/ /index.html;
    proxy_pass https://nginx_boot/;
}
```





### 12.2.2 è½¬å‘ç«¯å£

#### 12.2.2.1 hostsæ–‡ä»¶ä¸­

C:\Windows\System32\drivers\etc\hosts æ·»åŠ 

```
127.0.0.1       a.b.com
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¿é—® http://a.b.com

æ³¨æ„è¿™é‡Œçš„host åé¢ä¸èƒ½å¤ŸåŠ ç«¯å£ï¼Œä¸ç„¶è®¿é—®å¤±æ•ˆã€‚

æ³¨æ„å¦‚æœä½ å¯åŠ¨çš„æœåŠ¡æœ‰ ssl ä¹Ÿå°±æ˜¯ https æœåŠ¡ ã€‚ é‚£ä¹ˆå¯ä»¥åœ¨å‰ç¼€å¤´åŠ ä¸Šså˜æˆhttps://a.b.com





#### 12.2.2.2 nginx.conf

```shell
#gzip  on;
    server {
    	# è‡ªå·±çš„åœ°å€
        listen       8280;
        server_name  a.b.com;
        # error_page   405 =200 @405;
        location /api {
            add_header 'Access-Control-Allow-Origin' *;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            add_header 'Access-Control-Allow-Headers' *;
            # error_page 405 =200 http://$host$request_uri;
            #åç«¯ çš„ åœ°å€
            proxy_pass http://localhost:8088;
            proxy_redirect off;
            proxy_set_header Host $host;
			proxy_set_header X-Forwarded-Proto $scheme;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header Upgrade $http_upgrade; 
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_connect_timeout 18000;
			proxy_send_timeout 18000;
			proxy_read_timeout 18000;
            # index  index.html index.htm index.jsp;
            
        }

    }
```



#### 12.2.2.3 å¯åŠ¨ | é‡å¯ nginx è„šæœ¬

```shell
# reload.bat
nginx -s reload

# start.bat
@echo off
rem å¦‚æœå¯åŠ¨å‰å·²ç»å¯åŠ¨nginxå¹¶è®°å½•ä¸‹pidæ–‡ä»¶ï¼Œä¼škillæŒ‡å®šè¿›ç¨‹
nginx.exe -s stop

rem æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®æ€§
nginx.exe -t -c conf/nginx.conf

rem æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
nginx.exe -v

rem æŒ‰ç…§æŒ‡å®šé…ç½®å»å¯åŠ¨nginx
nginx.exe -c conf/nginx.conf

@REM  é‡å¯å‘½ä»¤ï¼šnginx -s reload 
@REM nginx -s quit   å¹³ç¨³å…³é—­Nginxï¼Œä¿å­˜ç›¸å…³ä¿¡æ¯ï¼Œæœ‰å®‰æ’çš„ç»“æŸwebæœåŠ¡

```

#### 12.2.2.4 æµ‹è¯•js

```js
 let ajax1 = (data, url) => {
     //step1 : è®¾ç½®è¯·æ±‚å¤´
     let xhr = new XMLHttpRequest();
     //step2ï¼šè®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚å¤´ //trueè¡¨ç¤ºå¼‚æ­¥
     xhr.open("POST", url, true);
     xhr.setRequestHeader("Content-type", "application/json");
     //step3ï¼šè¯·æ±‚æ•°æ®
     xhr.send();
     // step4ï¼šreadyStateæ˜¯xhrçš„è¯·æ±‚çŠ¶æ€
     //çŠ¶æ€4è¡¨ç¤ºå·²å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å·²å®Œæˆè¿”å›å“åº”ï¼Œæµè§ˆå™¨å·²å®Œæˆäº†ä¸‹è½½å“åº”å†…å®¹ã€‚0-4éƒ½æœ‰å€¼çš„
     xhr.onreadystatechange = function () {

         if (xhr.readyState === 4 && xhr.status === 200) {
             console.log(xhr.responseText);
         }
     };
 }
 let url = "/api/post"

 ajax1(url, url)
```



### 12.2.3 è™šæ‹Ÿäººç«¯å£ç¤ºä¾‹ /etc/nginx/sites-enabled/vh2d

```shell
#map $sent_http_content_type $expires {
#    default                    off;
    #text/html                  epoch; # ä¸ç¼“å­˜
#    text/css                   max; 
#    application/javascript     max;
#    ~image/                    max;  
#}
server {
    listen 80 default_server;
    server_name virtualhuman.cvte.com;
#    expires $expires;

    location /admin {
        alias /var/digitalHuman/virtualHumanAdmin/dist;
        index  index.html index.htm;
        try_files $uri $uri/ /admin/index.html;
            if ($request_filename ~* .*\.(?:htm|html)$){
        } 
        client_max_body_size    1000m;
   }
 
    location / {
        alias /var/digitalHuman/digitalHuman/dist/;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html;
        client_max_body_size    1000m;
        if ($request_filename ~* .*\.(?:htm|html)$){
        } 
    }

    location /api {
        proxy_pass http://localhost:8081;
        proxy_set_header X-forwarded-for $proxy_add_x_forwarded_for;
        proxy_set_header X-forwarded-proto https;
        proxy_set_header X-forwarded-host $host;
    }

    location /worker1 {
        proxy_pass http://localhost:8090;
    }

    location ~ ^/(resource|output)/ {
        proxy_pass http://localhost:9000;

	proxy_set_header Host $host;
    }
}


```



### 12.2.4 ä¸ªäººç«¯å£ç¤ºä¾‹

```shell
user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##
        client_max_body_size 100m;
	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;

	##
	# Gzip Settings
	##

	gzip on;



	include /etc/nginx/conf.d/*.conf;
	# é‡è¦
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}

```









### 12.2.5 ç¼“å­˜æ²¡å‘½ä¸­çš„bug

```shell
pï¼šé…ç½®äº† åå‘ä»£ç†
location /api/ {
	proxy_pass http://127.0.0.1:8080/;
	proxy_set_header Host $host
}
ä½†æ˜¯è¯·æ±‚å›¾ç‰‡çš„æ—¶å€™åœ¨ nginxå°±è¿”å›äº†404ï¼ˆä¸å‘½ä¸­ï¼‰

sï¼šå› ä¸ºé…ç½®äº† ç¼“å­˜
location ~ .*\.(jpg | gif)
{
	expires 30d
}
æˆ‘ä»¬å¯ä»¥
location ^~ /api/ {
	proxy_pass http://127.0.0.1:8080/;
	proxy_set_header Host $host
}
#^~æ„æ€æ˜¯åœ¨æ­£åˆ™ä»¥å‰
#~æ„æ€æ˜¯æ­£åˆ™åŒ¹é…
è¿™æ ·ä¼˜å…ˆçº§å°±æ¯”è¾ƒé«˜äº†
```





## 12.3 shell 







### 12.3.1 åŸºç¡€



#### string

```sh
test=5;echo $test
if [ "test" ]; then
echo "åˆ é™¤æ—§é•œåƒæˆåŠŸ"
 
fi
```





#### 12.3.1.1 å¾ªç¯

```shell
echo "è¯·è¾“å…¥ä½ æƒ³æ²Ÿé€šçš„äººæ•°"
read n
count=1
while ((count<=n))
do  
    # do something
    
    sleep 2
    echo "å½“å‰æ²Ÿé€šäº†: $count äºº"
    ((count++))
    sleep 2
done
```



#### 12.3.1.2  æ•°ç»„

```shell
# 1.æ•°ç»„å£°æ˜ åç§°=(å…ƒç´  å…ƒç´  å…ƒç´ ) =å·¦å³èµ‹å€¼çš„æ—¶å€™ä¸ç”¨åŠ ç©ºæ ¼ 

# "" å˜æˆ å˜é‡ , '' å…¨éƒ¨ä¸æ˜¯å˜é‡éƒ½æ˜¯å­—ç¬¦ä¸²
# ARRAY_NAME=("element_1st" "element_2nd" "element_3th")

# 2.æ‰“å°å…ƒç´ 
# 2.1 æ‰“å°æ‰€æœ‰ å…ƒç´ 
# echo ${ARRAY_NAME[@]}
# 2.2 æ‰“å°å•ä¸ªå…ƒç´ 
# echo ${ARRAY_NAME[0]}
# 2.3 å¾ªç¯æ‰“å°
# for i in "${ARRAY_NAME[@]}"; do 
# echo "$i"; 
# done

ARRAY_NAME=()
ARRAY_NAME+=("æ–‡ä»¶ '%s'\n" *.sh)
echo ${ARRAY_NAME[@]}


```







### 12.3.2 æŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ çš„ æ–‡ä»¶ | å†™å…¥

```shell
ARRAY_NAME=()
ARRAY_NAME+=(*.sh)


count=1
echo ${ARRAY_NAME[0]} 

for i in "${ARRAY_NAME[@]}"; do 
    # > æ˜¯ å¼ºåˆ¶è¦†å†™
    # >> æ˜¯ åœ¨å°¾éƒ¨æ·»åŠ 
    #  $(date +%Y%m%d%H%M%S) å¯¹åº”ç€å¹´ æœˆ æ—¥ æ—¶åˆ†ç§’
    echo "$i $(date +%Y%m%d%H%M%S) $count " >> output.txt; 
    ((count++))
done
```











### 12.3.3 æŸ¥æ‰¾æ–‡ä»¶

```shell
find /xx "xx.conf"
```





### 12.3.4 æŸ¥æ‰¾æ·±åº¦æ–‡ä»¶åˆ°å½“å‰çš„æ–‡ä»¶å¤¹ä¸‹é¢

```js
find . -name "*.js"   -exec mv '{}' ./ \;
```



### 12.3.5 ç§»åŠ¨ å¤åˆ¶ åˆ é™¤ é‡æ–°å‘½å

```shell
echo "hello world"
# 1.åˆ›é€ 
touch æ–‡ä»¶
mkdir ç›®å½•å
sleep 3
# ç§»åŠ¨æ–‡ä»¶

# 2. å‘½å å’Œ ç§»åŠ¨ æ–‡ä»¶ mv æ–‡ä»¶  D:/cicd-test/ç›®å½•å
# é‡æ–°å‘½å
mv æ–‡ä»¶ é‡æ–°å‘½åæ–‡ä»¶
mv  ç›®å½•å/ é‡æ–°å‘½åç›®å½•å/
sleep 3
echo "6s after"
# rm æ–‡ä»¶
# rmdir ç›®å½•å



```







### 12.3.6 CICD ç¤ºä¾‹

```shell


â€‹```SH
# window çš„æ‰©å±• ï¼š https://www.azimiao.com/8040.html

# step1 ï¼š https://sourceforge.net/projects/gnuwin32/files/zip/3.0/ 
# step2 ï¼š æ‰¾åˆ° Git æ–‡ä»¶å¤¹ä¸‹çš„usr/binç›®å½•ï¼Œå°†è§£å‹åbiné‡Œé¢çš„ä¸œè¥¿å¤åˆ¶è¿›å»

# æå‰ ssh é…ç½® ä¸€ä¸‹

# ssh root@10.21.2.47 -p 222

# ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ è¾“å‡ºï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¾“å…¥
node test.js
zip  ./dist.zip ./build -r

scp  -P 222 -r dist.zip root@10.21.2.47:/root/project  # ä¸Šä¼ ç›®å½•
ssh root@10.21.2.47 -p 222 < easyUnzip.sh
â€‹```



easyUnzip.sh

â€‹```SH
# è§£å‹è¿›è¡Œè¦†ç›–
unzip -o /root/project/dist.zip -d /root/project/
â€‹```


```









## 12.4 cicdç­–ç•¥(å››ä¸ª)



cicdç­–ç•¥

1. ä¸»åˆ†æ”¯ç¦æ­¢ç›´æ¥ PUSH ä»£ç 
2. ä»£ç éƒ½å¿…é¡»é€šè¿‡ PR æ‰èƒ½åˆå¹¶åˆ°ä¸»åˆ†æ”¯
3. **åˆ†æ”¯å¿…é¡» CI æˆåŠŸæ‰èƒ½åˆå¹¶åˆ°ä¸»åˆ†æ”¯**
4. ä»£ç å¿…é¡»ç»è¿‡ Code Review (å…³äºè¯¥ PR ä¸‹çš„æ‰€æœ‰ Review å¿…é¡»è§£å†³)
5. ä»£ç å¿…é¡»ä¸¤ä¸ªäººåŒæ„æ‰èƒ½åˆå¹¶åˆ°ä¸»åˆ†æ”¯



```
workflow ï¼ˆæµç¨‹ï¼‰ï¼šæŒç»­é›†æˆä¸€æ¬¡è¿è¡Œçš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ª workflowã€‚
job ï¼ˆä»»åŠ¡ï¼‰ï¼šä¸€ä¸ª workflow ç”±ä¸€ä¸ªæˆ–å¤šä¸ª jobs æ„æˆï¼Œå«ä¹‰æ˜¯ä¸€æ¬¡æŒç»­é›†æˆçš„è¿è¡Œï¼Œå¯ä»¥å®Œæˆå¤šä¸ªä»»åŠ¡ã€‚
stepï¼ˆæ­¥éª¤ï¼‰ï¼šæ¯ä¸ª job ç”±å¤šä¸ª step æ„æˆï¼Œä¸€æ­¥æ­¥å®Œæˆã€‚
action ï¼ˆåŠ¨ä½œï¼‰ï¼šæ¯ä¸ª step å¯ä»¥ä¾æ¬¡æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤ï¼ˆactionï¼‰
```









### 12.4.1 gitee ç­–ç•¥



```yaml
https://gitee.com/features/gitee-go  ä¸­å¼€é€šï¼Œæˆ–è€…å…·ä½“çš„é¡¹ç›®ä¸­å¼€é€šgitee go

å½“æˆ‘ä»¬é€‰æ‹©ç”¨node.jsçš„æ–¹å¼è¿›è¡Œåˆ›å»ºçš„æ—¶å€™ä¼šç”Ÿæˆmaster-pipeline.yml

gitee

â€‹```yaml
version: '1.0'
name: master-pipeline
displayName: MasterPipeline
stages:
  - stage: 
    name: compile
    displayName: ç¼–è¯‘
    steps:
      - step: build@nodejs
        name: build_nodejs
        displayName: Nodejs æ„å»º
        # æ”¯æŒ8.16.2ã€10.17.0ã€12.16.1ã€14.16.0ã€15.12.0äº”ä¸ªç‰ˆæœ¬
        nodeVersion: 14.16.0
        # æ„å»ºå‘½ä»¤ï¼šå®‰è£…ä¾èµ– -> æ¸…é™¤ä¸Šæ¬¡æ‰“åŒ…äº§ç‰©æ®‹ç•™ -> æ‰§è¡Œæ„å»º ã€è¯·æ ¹æ®é¡¹ç›®å®é™…äº§å‡ºè¿›è¡Œå¡«å†™ã€‘
        commands:
          - npm install && rm -rf ./dist && npm run build
        # éå¿…å¡«å­—æ®µï¼Œå¼€å¯åè¡¨ç¤ºå°†æ„å»ºäº§ç‰©æš‚å­˜ï¼Œä½†ä¸ä¼šä¸Šä¼ åˆ°åˆ¶å“åº“ä¸­ï¼Œ7å¤©åè‡ªåŠ¨æ¸…é™¤
        artifacts:
            # æ„å»ºäº§ç‰©åå­—ï¼Œä½œä¸ºäº§ç‰©çš„å”¯ä¸€æ ‡è¯†å¯å‘ä¸‹ä¼ é€’ï¼Œæ”¯æŒè‡ªå®šä¹‰ï¼Œé»˜è®¤ä¸ºBUILD_ARTIFACTã€‚åœ¨ä¸‹æ¸¸å¯ä»¥é€šè¿‡${BUILD_ARTIFACT}æ–¹å¼å¼•ç”¨æ¥è·å–æ„å»ºç‰©åœ°å€
          - name: BUILD_ARTIFACT
            # æ„å»ºäº§ç‰©è·å–è·¯å¾„ï¼Œæ˜¯æŒ‡ä»£ç ç¼–è¯‘å®Œæ¯•ä¹‹åæ„å»ºç‰©çš„æ‰€åœ¨è·¯å¾„
            path:
              - ./dist
      - step: publish@general_artifacts
        name: publish_general_artifacts
        displayName: ä¸Šä¼ åˆ¶å“
        # ä¸Šæ¸¸æ„å»ºä»»åŠ¡å®šä¹‰çš„äº§ç‰©åï¼Œé»˜è®¤BUILD_ARTIFACT
        dependArtifact: BUILD_ARTIFACT
        # ä¸Šä¼ åˆ°åˆ¶å“åº“æ—¶çš„åˆ¶å“å‘½åï¼Œé»˜è®¤output
        artifactName: output
        dependsOn: build_nodejs
  - stage: 
    name: release
    displayName: å‘å¸ƒ
    steps:
      - step: publish@release_artifacts
        name: publish_release_artifacts
        displayName: 'å‘å¸ƒ'
        # ä¸Šæ¸¸ä¸Šä¼ åˆ¶å“ä»»åŠ¡çš„äº§å‡º
        dependArtifact: output
        # å‘å¸ƒåˆ¶å“ç‰ˆæœ¬å·
        version: '1.0.0.0'
        # æ˜¯å¦å¼€å¯ç‰ˆæœ¬å·è‡ªå¢ï¼Œé»˜è®¤å¼€å¯
        autoIncrement: true
triggers:  # ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ï¼Œè¿™é‡Œæ˜¯åœ¨pushä»£ç çš„æ—¶å€™ä¼šè§¦å‘
  push:
    branches:
      include:
        - master
â€‹```





github ç‚¹å‡»actions,ç‚¹å‡» set up a workflow yourself 

â€‹```yaml
# æµç¨‹åå­—
name: CI

# ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘
on:
  #schedule:  # æ¯å¤©8ï¼š30åšä¸€äº›äº‹æƒ…
    #- cron:  '30 8 * * *'
  push:
    branches: [ "main" ]
  pull_request: 
    branches: [ "main" ] 
    types: 
    	- opened# å½“æ–°å»ºäº†ä¸€ä¸ª PR æ—¶
      - synchronize# å½“æäº¤ PR çš„åˆ†æ”¯ï¼Œæœªåˆå¹¶å‰å¹¶æ‹¥æœ‰æ–°çš„ Commit æ—¶
  workflow_dispatch:
# å…·ä½“åšçš„äº‹æƒ…
jobs:
  # å‘½åè¿™ç©æ„å«åšbuild
  build:
    # è¡¨ç¤ºåœ¨ä»€ä¹ˆç³»ç»Ÿä¸‹é¢è¿è¡Œçš„
    runs-on: ubuntu-latest

    # æ¯ä¸€ä¸ª- ä»£è¡¨ä¸€ä¸ªæ­¥éª¤
    steps:
      # æŠŠä»£ç ä¸‹è½½ä¸‹æ¥
      - uses: actions/checkout@v3

      # è¿è¡Œä¸€è¡Œè„šæœ¬
      - name: Run a one-line script
        run: echo Hello, world!

      # è¿è¡Œä¸¤è¡Œè„šæœ¬
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.

â€‹```






```



### 12.4.2 github

```YAML


.github/workflows

â€‹```yaml
# å…³äºæœ¬æ¬¡ workflow çš„åå­—
name: CI

# æ‰§è¡Œ CI çš„æ—¶æœº: å½“ git push ä»£ç åˆ° github æ—¶
on:
#   schedule:  # æ¯å¤©8ï¼š30åšä¸€äº›äº‹æƒ…
#     - cron:  '30 8 * * *'
  push:
    branches: [ "main" ]
  pull_request: 
    branches: [ "main" ] 
    types: 
      # å½“æ–°å»ºäº†ä¸€ä¸ª PR æ—¶ # å½“æäº¤ PR çš„åˆ†æ”¯ï¼Œæœªåˆå¹¶å‰å¹¶æ‹¥æœ‰æ–°çš„ Commit æ—¶
      - opened
      - synchronize

# æ‰§è¡Œæ‰€æœ‰çš„ jobs
jobs:

  #å‘½åæˆlint
  lint:
    runs-on: ubuntu-latest
    steps:
      # åˆ‡å‡ºä»£ç ï¼Œä½¿ç”¨è¯¥ Action å°†å¯ä»¥æ‹‰å–æœ€æ–°ä»£ç 
      #- uses: actions/checkout@v2

      # é…ç½® node.js ç¯å¢ƒï¼Œæ­¤æ—¶ä½¿ç”¨çš„æ˜¯ node14
      # æ³¨æ„æ­¤å¤„ node.js ç‰ˆæœ¬ï¼Œä¸ Docker ä¸­ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ package.json ä¸­ engines.node ç‰ˆæœ¬ä¸€è‡´
      # å¦‚æœéœ€è¦æµ‹è¯•ä¸åŒ node.js ç¯å¢ƒä¸‹çš„è¡¨ç°ï¼Œå¯ä½¿ç”¨ matrix
      # uses: actions/checkout@v2  è¿™ç©æ„å¯ä»¥åœ¨ ubuntu-20.04, ubuntu-18.04,ä¸Šè¿›è¡Œæµ‹è¯•
      - name: Setup Node
        uses: actions/checkout@v2
        with:
          node-version: 14.x.
      # å®‰è£…ä¾èµ–
      - name: Install Dependencies
        run: npm install 
      # åœ¨ cra ä¸­ï¼Œä½¿ç”¨ npm run lint æ¥æ¨¡æ‹Ÿ ESLint
      - name: ESLint
        run: npm run lint
      # æµ‹è¯•è¿™ç©æ„
      - name: nodeè„šæœ¬è·å–å¤©æ°”
        run: node test.js
      # åœ¨ npm audit --json
      - name: auditä¾èµ–åŒ…æ‰«æ
        run: npm audit --json
      #è¿è¡Œä¸€æ®µè„šæœ¬è¯•è¯•æ°´
      - name: Run a one-line script
        run: echo Hello, world!
      
  #å‘½åæˆerror
  error:
    runs-on: ubuntu-latest
    steps:
      # è¿è¡Œbashè¯•è¯•æ°´
      - name: Run a multi-line script
        shell: bash
        run: |
          sh pulish001.sh
â€‹```


```







### 12.4.3 CICD | è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·

package_version_auto_add.js

```ts
const execSync = require('child_process').execSync
const path = require('path')
const fs = require('fs')

console.log('------------ å¼€å‘è‡ªåŠ¨å‡çº§package.jsonç‰ˆæœ¬å· ------------');

const projectPath = path.join(__dirname, './')

const packageJsonStr = fs.readFileSync('./package.json').toString()

try {
    const packageJson = JSON.parse(packageJsonStr)
    // å‡çº§ç‰ˆæœ¬å·
    const arr = packageJson.version.split('.')
    if (arr[2] < 9) {
        arr[2] = +arr[2] + 1
    } else if (arr[1] < 9) {
        arr[1] = +arr[1] + 1
        arr[2] = 0
    } else {
        arr[0] = +arr[0] + 1
        arr[1] = 0
        arr[2] = 0 
    }
    const newVersion = arr.join('.')
    packageJson.version = newVersion

    // console.log(packageJson);

    fs.writeFileSync('./package.json', JSON.stringify(packageJson, null, '\t'))

    // add new package.json
    execSync(`git add package.json`)
} catch (e) {
    console.error('å¤„ç†package.jsonå¤±è´¥ï¼Œè¯·é‡è¯•', e.message);
    process.exit(1)
}



```



### 12.4.4 CICD |  ç¯å¢ƒåŒºåˆ†

#### 1.é¦–å…ˆæ–°å»ºconfigæ–‡ä»¶å¤¹ï¼Œ

ç„¶åæˆ‘ä»¬å†™å…¥dev.env.js,test.env.js,pro.env.js(ç”Ÿäº§ç¯å¢ƒ)

```js
// å¼€å‘ç¯å¢ƒ dev.env.js

module.exports = {
    NODE_ENV: '"development"',
    URL_RSP: 'http://xxx.xxx.xxx.xxx:xxxx',//å¼€å‘ç¯å¢ƒä¸‹çš„æ¥å£åœ°å€ï¼Œå¦‚æœæœ‰å¤šä¸ªåœ°å€å¯ä»¥å†™å¦‚ä¸‹
    URL_IM: 'http://xxx.xxx.xxx.xxx:xxxx',
}
// æµ‹è¯•ç¯å¢ƒ test.env.js

module.exports = {
    NODE_ENV: '"test"',
    URL_RSP: 'http://xxx.xxx.xxx.xxx:xxxx',
    URL_IM: 'http://xxx.xxx.xxx.xxx:xxxx',
}
// ç”Ÿäº§ç¯å¢ƒ pro.env.js
module.exports = {
    NODE_ENV: '"production"',
    URL_RSP: 'http://xxx.xxx.xxx.xxx:xxxx',
    URL_IM: 'http://xxx.xxx.xxx.xxx:xxxx',
}

devServerå¯ä»¥ç±»ä¼¼äº: {
        disableHostCheck: true,
        proxy: {
            '/xxx/xx/': {
                target: URL_RSP,//è¿™é‡Œé…ç½®åœ°å€
                changeOrigin: true, // å…è®¸è·¨åŸŸ
                pathRewrite: {
                    '^/xxx/xx/': '/'
                }
            '/xxx/xxx/': {
                target: URL_IM,//é…ç½®åœ°å€
                changeOrigin: true, // å…è®¸è·¨åŸŸ
                pathRewrite: {
                    '^/xxx/xxx/': '/'
                }
            },
        }
    },
```



#### 2.vue.config.jsä¸­æˆ‘ä»¬å†™

```js
var proEnv = require('./src/config/pro.env'); // ç”Ÿäº§ç¯å¢ƒ
var testEnv = require('./src/config/test.env'); // æµ‹è¯•ç¯å¢ƒ
var devEnv = require('./src/config/dev.env'); // æœ¬åœ°ç¯å¢ƒ

const env = process.env.NODE_ENV;//å½“å‰ç¯å¢ƒ
let URL_RSP = '';//è·¯å¾„
let URL_IM = '';//è·¯å¾„
// é»˜è®¤æ˜¯æœ¬åœ°ç¯å¢ƒ
if (env === 'production') { // ç”Ÿäº§ç¯å¢ƒ
    console.log("----------ç”Ÿäº§ç¯å¢ƒ----------");
    URL_RSP = proEnv.URL_RSP;
    URL_IM = proEnv.URL_IM;
} else if (env === 'test') { // æµ‹è¯•ç¯å¢ƒ
    console.log("----------æµ‹è¯•ç¯å¢ƒ----------");
    URL_RSP = testEnv.URL_RSP;
    URL_IM = testEnv.URL_IM;
} else { // å¼€å‘ç¯å¢ƒ
    console.log("----------å¼€å‘ç¯å¢ƒ----------");
    URL_RSP = devEnv.URL_RSP;
    URL_IM = devEnv.URL_IM;
}

```



#### 3. packageä¸­é…ç½®

 "dev": "vue-cli-service serve --mode=test",



æˆ–è€…  npm install cross-env

"serve": "cross-env NODE_ENV=production vue-cli-service serve",





## 12.5 è™šæ‹Ÿæœºéƒ¨ç½²å‰ç«¯é¡¹ç›®(centos7)

### 12.5.1 è™šæ‹Ÿæœºçš„åˆå§‹åŒ–

- å®‰è£…åŸºæœ¬å·¥å…·
- pingä¸€ä¸‹ç½‘ç»œ

### 12.5.2 docker å®‰è£… 

- ç®€å•å®‰è£…ï¼Œæµ‹è¯•ä¸€ä¸‹åŸºæœ¬å‘½ä»¤

### 12.5.3  nginx 

- é˜²ç›—é“¾åŸºæœ¬é…ç½®
- åå‘ä»£ç†
  - ç®€å•æ­å»ºä¸€ä¸ªæœåŠ¡å¹¶ä¸”æµ‹è¯•node
- å¼€å¯gzip
- æ­£å‘ä»£ç†(ç®€å•è®²ä¸€ä¸‹)

### 12.5.4 è‡ªåŠ¨éƒ¨ç½²è„šæœ¬æµ‹è¯•(CICDç¤ºä¾‹)

- æ¨åˆ°docker hub
- æ‹‰åˆ°æœåŠ¡å™¨ç„¶åè¿è¡Œdocker 
- å¹³å°çš„CICDç­–ç•¥å°±æ˜¯  æ·»åŠ è¿œç¨‹ä¸»æœº ç„¶å æ‰§è¡Œyaml (å„ä¸ªå¹³å°ä¸ä¸€æ ·è¿™é‡Œä¸åšæ¼”ç¤º)









## 12.6 æœåŠ¡å™¨å®ä¾‹

ä¹Œé‚¦å›¾ 20.04

### 12.6.1 åŸºç¡€é…ç½®

å®‰è£…dockeræŠ¥é”™ yumå‘½ä»¤æ‰¾ä¸åˆ°

```shell
 sudo -s   #åˆ‡æ¢åˆ°root
 apt-get install build-essential
 apt-get install yum
 
apt-get install docker
apt install docker.io
docker --version   # Docker version 1.13.1, build 7d71120/1.13.1
systemctl start docker

# å¯åŠ¨ docker ï¼šservice docker start
# docker run -d --name $container_name -p å¯¹å¤–é¢æš´éœ²çš„ç«¯å£:80 $docker_hub_username/$docker_image_name:$docker_image_version
# # docker run -d --name bimddp_image -p 81:80 electroluxcode/bimddp_image:1.1


```

















### 12.1.9 Dockerfile(æ„å»ºnginxåŸºç¡€ç¤ºä¾‹)

Dockerfile æ˜¯ä¸€ä¸ªæ–‡ä»¶,ç”¨æ¥æ„å»ºimage

```yaml
FROM nginx


RUN rm -rf /usr/share/nginx/html
RUN rm /etc/nginx/nginx.conf

# ä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºåçš„æ–‡ä»¶åˆ°Nginxé•œåƒçš„HTMLç›®å½•
COPY html /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf 
# COPY nginx.conf etc/nginx/conf.d/default.conf
RUN echo "nginx å¼€å§‹æ„å»º"

# æš´éœ²ç«¯å£81ä¾›å¤–éƒ¨è®¿é—®
EXPOSE 81

# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
    

```

è¿™ä¸€æ­¥èµ°å®Œå å¯ä»¥è¿è¡Œ

```shell
docker build  --platform linux/amd64 -t ä½ çš„ç”¨æˆ·å/ä½ çš„é•œåƒæˆ–è€…æ˜¯ä»“åº“åå­—:ç‰ˆæœ¬å·  . 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æŸ¥çœ‹åˆšåˆšç”Ÿæˆçš„ images
docker images 

# å¯ä»¥è¿è¡Œ ä¸‹é¢å‘½ä»¤æ¨é€åˆ°è¿œç«¯å» 
docker push $docker_hub_username/$docker_image_name:$docker_image_version

```

















### 12.1.10 nginx.conf ç¼–å†™



```shell
worker_processes 1;


events {
	worker_connections 768;
}

http {
    # çŸ¥è¯†ç‚¹6:å¼€å¯gzip
    gzip on;
    # å¯ç”¨gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶ï¼›å°äºè®¾ç½®å€¼çš„æ–‡ä»¶å°†ä¸ä¼šè¢«å‹ç¼©
    gzip_min_length 1k;
    # gzip å‹ç¼©çº§åˆ« 1-9 
    gzip_comp_level 9;
    # è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
    # æ˜¯å¦åœ¨http headerä¸­æ·»åŠ Vary: Accept-Encodingï¼Œå»ºè®®å¼€å¯
    gzip_vary on;



	include /etc/nginx/mime.types;
	default_type application/octet-stream;
	sendfile	on;
	keepalive_timeout	65;
	access_log /var/log/nginx/access.log;
	error_log /var/log/nginx/error.log;
    upstream myserver { 
        # è½®è¯¢æ–¹å¼ | ip_hashï¼šä»¥å®¢æˆ·ç«¯IPåœ°å€ä¸ºä¾æ®ï¼ŒåŒ¹é…æœåŠ¡å™¨ã€‚ | least_connï¼šä»¥æœåŠ¡å™¨è¿æ¥æ•°ä¸ºä¾æ®ï¼Œå“ªä¸ªæœåŠ¡å™¨è¿æ¥æ•°å°‘ï¼ŒåŒ¹é…å“ªå°æœåŠ¡å™¨ã€‚
        # ip_hash; 
        # 10ç§’å†…å¦‚æœå¤±è´¥æ¬¡æ•°è¾¾åˆ°2æ¬¡ï¼Œä¼šåœç”¨10ç§’ server å‰é¢ä¸ç”¨åŠ https
        server 192.168.1.123:8088 max_fails=2  fail_timeout=10s;
        # åœç”¨
        # server localhost:8080 weight=10 down;     
        # é•¿è¿æ¥æ•°é‡
        # keepalive 50;
    }
    server {
        listen     80;
        server_name localhost;
        # çŸ¥è¯†ç‚¹1ï¼šé˜²ç›—é“¾
        location /images {
            valid_referers  192.168.80.133 localhost example.*;
            if ($invalid_referer){
                return 403;
            }
            alias /usr/share/nginx/html;
            try_files $uri $uri/ =404;
            # add_header Cache-Control no-cache;
            # add_header Cache-Control private;
        }
        # çŸ¥è¯†ç‚¹2ï¼šåå‘ä»£ç†
        location /api {
            
            proxy_pass http://192.168.1.123:8088;
            add_header 'Access-Control-Allow-Origin' é—¹ç€ç©;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }

        # çŸ¥è¯†ç‚¹3ï¼šå‰ç«¯æ–‡ä»¶
		location / {
			root /usr/share/nginx/html;
			try_files $uri/ /index.html last;
			index index.html index.htm;
		}

        # çŸ¥è¯†ç‚¹4:cdnæ­£å‘ä»£ç†
        

        location /api_proxy {
            
            proxy_pass http://myserver;
            add_header 'Access-Control-Allow-Origin' *;
            #å…è®¸å¸¦ä¸Šcookieè¯·æ±‚
            #add_header 'Access-Control-Allow-Credentials' 'true';
            #å…è®¸è¯·æ±‚çš„æ–¹æ³•ï¼Œæ¯”å¦‚ GET/POST/PUT/DELETE
            #add_header 'Access-Control-Allow-Methods' *;
            #å…è®¸è¯·æ±‚çš„header
            #add_header 'Access-Control-Allow-Headers' *;
            # add_header 'Cache-Control' max-age=36000000000;
        }
        # çŸ¥è¯†ç‚¹5ï¼šserver ç«¯å£ç¼“å­˜
        # proxy_cache_path  /data/nuget-cache levels=1:2 keys_zone=nuget-cache:20m max_size=50g inactive=168h;
	}
	

}
```





### 12.1.11 ç¼–å†™ html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
    <title>Document</title>
</head>
<style>
    *{
        text-decoration: none;
        
    }
    body{
        background-color: #ebecf0;
        display: flex;
        /* flex-direction: column; */
        width: 100%;
        overflow-x: hidden;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }
    div{
        margin: 30px;
        width: 250px;
        height: 100px;
        background: linear-gradient(145deg, #caced5, #f0f5fe);
box-shadow: 6px 6px 12px #bec3c9, -6px -6px 12px #fff;
        text-align: center;
        align-items: center;
        line-height: 100px;
    }
</style>
<body>
  <image src="./OIP-A.jpg"/>
  	<image src="/images/OIP-C.jpg"/>
    <div><a href="./project and frame/è®¾è®¡ç¨¿ä»£ç /index.html">è®¾è®¡ç¨¿ä»£ç </a></div>
    <div> <a href="./å¡ç‰‡/index.html">å¡ç‰‡</a></div>
    <!-- <div><a href="./3/index.html">3</a></div> -->
    <div><a href="./project and frame/ç™»é™†/index.html">ç™»é™†</a></div>
    <div> <a href="./404æ ·å¼/index.html">404æ ·å¼</a></div>
    <div> <a href="./åº•è¾¹æ /index.html">åº•è¾¹æ </a></div>
    <div> <a href="./project and frame/webrtc/index.html">webrtc</a></div>
    
    <div>ç­‰ç­‰ç­‰ç­‰..ä»¥åæŒç»­æ›´æ–°</div>
 
    <script>


async function ajax(options) {
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        const method = options.method.toUpperCase();
        xhr.onreadystatechange = () => {
            // xhr.readyState == 4 è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª
            if (xhr.readyState !== 4 || xhr.status === 0)
                return;
            const responseData = JSON.parse(xhr.response);
            // å½“ readyState ç­‰äº 4 ä¸”statusä¸º 200 æ—¶ï¼Œè¡¨ç¤ºå“åº”å·²å°±ç»ªï¼š
            if (xhr.status >= 200 && xhr.status < 300) {
                resolve(responseData);
            }
            else {
                reject(`request failed with status code ${xhr.status}`);
            }
        };
        if (method === 'GET') {
            let str = "?";
            let param = options.data;
            for (let i in param) {
                str += (str == "?") ? `${i}=${param[i]}` : `&${i}=${param[i]}`;
            }
            xhr.open(method, options.url + str, true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	xhr.setRequestHeader('Cache-Control', 'max-age=0.1');
            xhr.send(options.data);
        }
        if (method === 'POST') {
            xhr.open(method, options.url, true);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.send(JSON.stringify(options.data));
        }
    });
}
let option = {
    method: "GET",
    url: "/api/GET",
    data: {
        id: "d2ddd"
    }
};
ajax(option).then((e) => {
    console.log(e);
document.querySelector("img").src=e.data
document.querySelector("img").setAttribute("test",Math.random())
});
	</script>

  
</body>
</html>
```





### 12.1.12 å…å¯†ç ç™»å½• æœåŠ¡å™¨



- æœåŠ¡å™¨ï¼šssh-keygen -t rsa 

- æœ¬åœ°ï¼šssh-copy-id  -p 22 root@62.234.180.224
  ssh root@192.168.80.133 -p 22

- æœåŠ¡å™¨ï¼šchmod 700 /home/root

  chmod 700 ~/.ssh/

  chmod 600 ~/.ssh/authorized_keys









### 12.1.13 shell å¯åŠ¨

```shell
#!/bin/bash

# æœ‰é”™è¯¯ç›´æ¥é€€å‡º
set -e
# step1ï¼šåˆå§‹åŒ–å˜é‡
start_time=$(date +%s) # è®°å½•è„šæœ¬å¼€å§‹æ—¶é—´
docker_image_version=${1:-1.1} # Dockeré•œåƒç‰ˆæœ¬
docker_image_name=${2:-bimddp_image} # Docker ä»“åº“ image åå­—
docker_hub_username=${3:-electroluxcode} # Docker Hub ç”¨æˆ·å
container_name=${4:-bimddp_container} # å®¹å™¨åå­—
container_expose_port=${5:-81} # å®¹å™¨æš´éœ²çš„ç«¯å£

server_username=${6:-root} # LinuxæœåŠ¡å™¨ç”¨æˆ·å
server_address=${7:-192.168.80.133} # LinuxæœåŠ¡å™¨åœ°å€



# step2ï¼šæ²¡ç™»é™†é¦–å…ˆç™»å½•ä¸€ä¸‹
# docker login -u 3451613934@qq.com -p 
# yarn build

# step3ï¼š æ³¨æ„è¿™ä¸ª image åº”è¯¥è¦æå‰æ„å»º
# -t æŒ‡å®šæ„å»ºé•œåƒçš„åå­—å’Œç‰ˆæœ¬  -f è¿™ä¸ªå¥½åƒæ˜¯é”™çš„
echo -e "\e[91m --æœ¬åœ°buildä¸­--"
docker build  --platform linux/amd64 -t $docker_hub_username/$docker_image_name:$docker_image_version  . 
docker push $docker_hub_username/$docker_image_name:$docker_image_version
echo -e "\e[0m"

# 34---a48042d416af


# step4:è¿™ä¸€æ­¥å¯ä»¥ ssh-copy-id å»é™¤ç™»å½•  
# åŠ ä¸ŠåŒå¼•å·æ˜¯åœ¨æœåŠ¡å™¨ä¸­æ‰§è¡Œå‘½ä»¤,ä¸ç„¶å°±æ˜¯åœ¨æœ¬æœºæ‰§è¡Œå‘½ä»¤
echo -e "\e[92m --æœåŠ¡å™¨éƒ¨ç½²ä¸­--"
ssh -t $server_username@$server_address << EOF

docker ps
docker stop $container_name
docker rm $container_name

echo è¦åˆ é™¤çš„é•œåƒid:"\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
if [ -n "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)" ]; then
  docker rmi "\$(docker images -q $docker_hub_username/$docker_image_name:$docker_image_version)"
  echo "åˆ é™¤æ—§é•œåƒæˆåŠŸ"
fi


docker pull $docker_hub_username/$docker_image_name:$docker_image_version
if [ $? -ne 0 ]; then
  echo "Dockeré•œåƒæ‹‰å–å¤±è´¥,è„šæœ¬è¢«ç»ˆæ­¢."
  exit 1
fi

docker run -d --name $container_name -p $container_expose_port:80 $docker_hub_username/$docker_image_name:$docker_image_version
docker ps
exit

EOF


echo -e "\e[0m"

# docker images |  docker rmi  id id | docker rmi $(docker images -q)
# è®¡ç®—æ•´ä¸ªè„šæœ¬çš„ç”¨æ—¶
end_time=$(date +%s)
duration=$((end_time - start_time))
formatted_duration=$(date -u -d @"$duration" +"%H:%M:%S")

echo "âœ¨ğŸ‰ğŸˆæ­å–œæ‚¨, éƒ¨ç½²æˆåŠŸ!"
echo "æ•´ä¸ªè¿‡ç¨‹èŠ±è´¹ $formatted_duration"
```









### 12.4.14

æ³¨æ„å¾ˆå¯èƒ½å› ä¸ºç½‘ç»œåŸå› éƒ¨ç½²å¤±è´¥

ç«¯å£å·ä¸€è‡´

```sh
æ³¨æ„nginx.conf å’Œ å®¹å™¨çš„ç«¯å£å·ä¿æŒä¸€è‡´
ç„¶ådockerfile export çš„ ç«¯å£å· å’ŒæœåŠ¡å™¨ å¼€æ”¾çš„ç«¯å£å·ä¿æŒä¸€è‡´
```



ç®€å•çš„è°ƒè¯•å‘½ä»¤å¦‚ä¸‹

```sh
# docker ps
# docker exec -it 618518052e4c  /bin/bash
# cd /usr/share/nginx/html
```





## 12.7 verceléƒ¨ç½²



https://vercel.com/new   æ³¨å†Œä¸€ä¸‹ï¼Œè¿™ä¸ªéœ€è¦ç¿»å¢™

https://github.com/yilaikesi/data-card.git å¯¼å…¥è¿›å»

- ä¸»åˆ†æ”¯å˜åŠ¨ vercelä¼šè‡ªåŠ¨å¸®ä½ éƒ¨ç½²



### 12.7.1 node æœåŠ¡ç«¯ç¤ºä¾‹

```shell
npm i vercel -g
# 
vercel login # ç™»å½•ä¸€ä¸‹è´¦å·

```



æ ¹ç›®å½•ä¸‹é¢æ–°å»º vercel.json ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ã€‚

```json
{
  "version": 2,
  "name": "data-card",
  "builds": [
    {
      "src": "dist/app.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "dist/app.js"
    }
  ]
}
```



```shell
# åœ¨ä½ çš„é¡¹ç›®ä¸‹é¢æ‰§è¡Œ,å¦‚æœæ²¡æœ‰æŠ¥é”™ç›´æ¥æ¨é€å°±å¥½äº†
vercel dev  
# è¿™å°±å¯ä»¥éƒ¨ç½²æœåŠ¡äº†
vercel 
```



